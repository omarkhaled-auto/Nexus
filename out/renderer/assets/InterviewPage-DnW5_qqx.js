import { c as createLucideIcon, r as reactExports, j as jsxRuntimeExports, a as cn, u as useMessages, b as useIsInterviewing, d as useInterviewStore, e as useSessionId, f as useProjectStore, L as LoaderCircle, S as Sparkles, B as Bot, C as ChevronDown, g as useRequirements, h as useInterviewStage, i as useNavigate, t as toast } from "./index-BX2rC_Ui.js";
import { C as CircleAlert } from "./circle-alert-CGw4XaIP.js";
import { Z as Zap, F as FileText } from "./zap-BM3AjHaK.js";
import { C as Cpu, S as Save, R as RotateCcw } from "./save-CzjBgXJw.js";
import { L as Layers } from "./layers-C0IPhOjt.js";
import { C as CircleCheck } from "./circle-check-BqKNmVQx.js";
import { C as Circle, A as AnimatedPage } from "./AnimatedPage-nqnFWhSG.js";
import { T as Trash2 } from "./trash-2-CuL6AZV4.js";
import { D as Download } from "./download-Q2JbeO7Q.js";
import { A as ArrowLeft } from "./arrow-left-DKMkPiIn.js";
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$8 = [["path", { d: "M20 6 9 17l-5-5", key: "1gmf2c" }]];
const Check = createLucideIcon("check", __iconNode$8);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$7 = [
  ["rect", { width: "18", height: "11", x: "3", y: "11", rx: "2", ry: "2", key: "1w4ew1" }],
  ["path", { d: "M7 11V7a5 5 0 0 1 10 0v4", key: "fwvmzm" }]
];
const Lock = createLucideIcon("lock", __iconNode$7);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$6 = [
  [
    "path",
    {
      d: "M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",
      key: "e79jfc"
    }
  ],
  ["circle", { cx: "13.5", cy: "6.5", r: ".5", fill: "currentColor", key: "1okk4w" }],
  ["circle", { cx: "17.5", cy: "10.5", r: ".5", fill: "currentColor", key: "f64h9f" }],
  ["circle", { cx: "6.5", cy: "12.5", r: ".5", fill: "currentColor", key: "qy21gx" }],
  ["circle", { cx: "8.5", cy: "7.5", r: ".5", fill: "currentColor", key: "fotxhn" }]
];
const Palette = createLucideIcon("palette", __iconNode$6);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$5 = [
  [
    "path",
    {
      d: "M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",
      key: "1a8usu"
    }
  ],
  ["path", { d: "m15 5 4 4", key: "1mk7zo" }]
];
const Pencil = createLucideIcon("pencil", __iconNode$5);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$4 = [
  ["path", { d: "M12 22v-5", key: "1ega77" }],
  ["path", { d: "M15 8V2", key: "18g5xt" }],
  [
    "path",
    { d: "M17 8a1 1 0 0 1 1 1v4a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1z", key: "1xoxul" }
  ],
  ["path", { d: "M9 8V2", key: "14iosj" }]
];
const Plug = createLucideIcon("plug", __iconNode$4);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$3 = [
  [
    "path",
    {
      d: "M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",
      key: "1ffxy3"
    }
  ],
  ["path", { d: "m21.854 2.147-10.94 10.939", key: "12cjpa" }]
];
const Send = createLucideIcon("send", __iconNode$3);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$2 = [
  [
    "path",
    {
      d: "M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",
      key: "oel41y"
    }
  ]
];
const Shield = createLucideIcon("shield", __iconNode$2);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$1 = [
  ["path", { d: "M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2", key: "125lnx" }],
  ["path", { d: "M8.5 2h7", key: "csnxdl" }],
  ["path", { d: "M14.5 16h-5", key: "1ox875" }]
];
const TestTube = createLucideIcon("test-tube", __iconNode$1);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode = [
  ["path", { d: "M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2", key: "975kel" }],
  ["circle", { cx: "12", cy: "7", r: "4", key: "17ys0d" }]
];
const User = createLucideIcon("user", __iconNode);
function InterviewLayout({
  children,
  chatPanel,
  sidebarPanel,
  className,
  defaultSplitRatio = 0.6,
  minChatWidth = 400,
  minSidebarWidth = 300
}) {
  const containerRef = reactExports.useRef(null);
  const [splitRatio, setSplitRatio] = reactExports.useState(() => {
    const saved = localStorage.getItem("nexus-interview-split-ratio");
    return saved ? parseFloat(saved) : defaultSplitRatio;
  });
  const [isDragging, setIsDragging] = reactExports.useState(false);
  const handleMouseDown = reactExports.useCallback((e) => {
    e.preventDefault();
    setIsDragging(true);
  }, []);
  const handleMouseMove = reactExports.useCallback(
    (e) => {
      if (!isDragging || !containerRef.current) return;
      const containerRect = containerRef.current.getBoundingClientRect();
      const containerWidth = containerRect.width;
      const mouseX = e.clientX - containerRect.left;
      let newRatio = mouseX / containerWidth;
      const minChatRatio = minChatWidth / containerWidth;
      const maxChatRatio = 1 - minSidebarWidth / containerWidth;
      newRatio = Math.max(minChatRatio, Math.min(maxChatRatio, newRatio));
      setSplitRatio(newRatio);
    },
    [isDragging, minChatWidth, minSidebarWidth]
  );
  const handleMouseUp = reactExports.useCallback(() => {
    if (isDragging) {
      setIsDragging(false);
      localStorage.setItem("nexus-interview-split-ratio", splitRatio.toString());
    }
  }, [isDragging, splitRatio]);
  if (typeof window !== "undefined") {
    if (isDragging) {
      window.addEventListener("mousemove", handleMouseMove);
      window.addEventListener("mouseup", handleMouseUp);
    } else {
      window.removeEventListener("mousemove", handleMouseMove);
      window.removeEventListener("mouseup", handleMouseUp);
    }
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      ref: containerRef,
      className: cn(
        "flex h-full w-full",
        isDragging && "select-none cursor-col-resize",
        className
      ),
      "data-testid": "interview-layout",
      children: children ? children : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "flex-shrink-0 min-w-0 h-full",
            style: { width: `calc(${splitRatio * 100}% - 4px)` },
            "data-testid": "chat-panel-container",
            children: chatPanel
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: cn(
              "relative flex-shrink-0 w-2 h-full cursor-col-resize group",
              "hover:bg-accent-primary/20",
              isDragging && "bg-accent-primary/30"
            ),
            onMouseDown: handleMouseDown,
            "data-testid": "resize-handle",
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "div",
                {
                  className: cn(
                    "absolute left-1/2 top-0 h-full w-px -translate-x-1/2",
                    "bg-border-default transition-colors duration-150",
                    "group-hover:bg-accent-primary",
                    isDragging && "bg-accent-primary"
                  )
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "div",
                {
                  className: cn(
                    "absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",
                    "w-1 h-8 rounded-full",
                    "bg-border-default transition-colors duration-150",
                    "opacity-0 group-hover:opacity-100",
                    isDragging && "opacity-100 bg-accent-primary"
                  )
                }
              )
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: "flex-1 min-w-0 h-full",
            style: { width: `calc(${(1 - splitRatio) * 100}% - 4px)` },
            "data-testid": "sidebar-panel-container",
            children: sidebarPanel
          }
        )
      ] })
    }
  );
}
const urlAlphabet = "useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";
let nanoid = (size = 21) => {
  let id = "";
  let bytes = crypto.getRandomValues(new Uint8Array(size |= 0));
  while (size--) {
    id += urlAlphabet[bytes[size] & 63];
  }
  return id;
};
function MessageBubble({
  message,
  isLatest
}) {
  const isAI = message.role === "assistant";
  const isUser = message.role === "user";
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: cn("flex gap-3", isUser ? "justify-end" : "justify-start"),
      "data-testid": isAI ? "ai-message" : "user-message",
      children: [
        isAI && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-shrink-0 w-8 h-8 rounded-full bg-accent-primary/20 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Bot, { className: "w-4 h-4 text-accent-primary" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: cn(
              "max-w-[80%] px-4 py-3 relative",
              // AI Message styling
              isAI && [
                "bg-bg-card border border-border-default",
                "rounded-tl-none rounded-tr-xl rounded-br-xl rounded-bl-xl",
                "border-l-2 border-l-accent-primary"
              ],
              // User Message styling
              isUser && [
                "bg-accent-primary/10 border border-accent-primary/20",
                "rounded-tl-xl rounded-tr-none rounded-br-xl rounded-bl-xl"
              ],
              // Streaming animation
              message.isStreaming && "animate-pulse"
            ),
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "whitespace-pre-wrap text-sm text-text-primary leading-relaxed", children: message.content }),
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "mt-2 block text-xs text-text-tertiary", children: new Date(message.timestamp).toLocaleTimeString([], {
                hour: "2-digit",
                minute: "2-digit"
              }) }),
              message.isStreaming && isLatest && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1 mt-2", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-1.5 h-1.5 rounded-full bg-accent-primary animate-bounce", style: { animationDelay: "0ms" } }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-1.5 h-1.5 rounded-full bg-accent-primary animate-bounce", style: { animationDelay: "150ms" } }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-1.5 h-1.5 rounded-full bg-accent-primary animate-bounce", style: { animationDelay: "300ms" } })
              ] })
            ]
          }
        ),
        isUser && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-shrink-0 w-8 h-8 rounded-full bg-accent-secondary/20 flex items-center justify-center", children: /* @__PURE__ */ jsxRuntimeExports.jsx(User, { className: "w-4 h-4 text-accent-secondary" }) })
      ]
    }
  );
}
function WelcomeMessage() {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-center justify-center h-full px-8 text-center", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "w-16 h-16 rounded-full bg-accent-primary/20 flex items-center justify-center mb-6", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-8 h-8 text-accent-primary" }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-xl font-semibold text-text-primary mb-2", children: "Welcome to Genesis Mode" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-text-secondary max-w-md mb-6", children: "I'll help you define your project requirements through a guided conversation. Tell me about the application you want to build." }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex flex-wrap gap-2 justify-center max-w-lg", children: ["SaaS Platform", "Mobile App", "E-commerce Site", "Dashboard"].map((suggestion) => /* @__PURE__ */ jsxRuntimeExports.jsx(
      "span",
      {
        className: "px-3 py-1.5 text-xs bg-bg-card border border-border-default rounded-full text-text-secondary hover:text-text-primary hover:border-accent-primary/50 cursor-pointer transition-colors",
        children: suggestion
      },
      suggestion
    )) })
  ] });
}
function mapCategory(backendCategory) {
  const mapping = {
    "functional": "functional",
    "non-functional": "non_functional",
    "technical": "technical",
    "constraint": "constraint",
    "assumption": "functional"
    // Map assumptions to functional
  };
  return mapping[backendCategory] || "functional";
}
function mapPriority(backendPriority) {
  const mapping = {
    "must": "must",
    "should": "should",
    "could": "could",
    "wont": "wont"
  };
  return mapping[backendPriority] || "should";
}
function ChatPanel({ className }) {
  const messages = useMessages();
  const isInterviewing = useIsInterviewing();
  const addMessage = useInterviewStore((s) => s.addMessage);
  const addRequirement = useInterviewStore((s) => s.addRequirement);
  const setSessionId = useInterviewStore((s) => s.setSessionId);
  const sessionId = useSessionId();
  const currentProject = useProjectStore((s) => s.currentProject);
  const [input, setInput] = reactExports.useState("");
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const [error, setError] = reactExports.useState(null);
  const messagesEndRef = reactExports.useRef(null);
  const inputRef = reactExports.useRef(null);
  const isInitializing = reactExports.useRef(false);
  const initializeSession = reactExports.useCallback(async () => {
    if (sessionId || isInitializing.current) {
      return;
    }
    if (!window.nexusAPI) {
      setError("Backend not available. Please run in Electron to use the interview feature.");
      return;
    }
    isInitializing.current = true;
    setError(null);
    try {
      const projectId = currentProject?.id || `temp-${nanoid(8)}`;
      let session = await window.nexusAPI.interview.resumeByProject(projectId);
      if (!session) {
        session = await window.nexusAPI.interview.start(projectId);
      }
      if (session) {
        setSessionId(session.id);
        if (session.messages.length === 0) {
          const greeting = await window.nexusAPI.interview.getGreeting();
          addMessage({
            id: nanoid(),
            role: "assistant",
            content: greeting,
            timestamp: Date.now()
          });
        }
      }
    } catch (err) {
      console.error("Failed to initialize interview session:", err);
      const errorMessage = err instanceof Error ? err.message : "Failed to start interview session. Please try again.";
      setError(errorMessage);
    } finally {
      isInitializing.current = false;
    }
  }, [sessionId, currentProject?.id, addMessage, setSessionId]);
  reactExports.useEffect(() => {
    if (isInterviewing && !sessionId && !isInitializing.current) {
      void initializeSession();
    }
  }, [isInterviewing, sessionId, initializeSession]);
  reactExports.useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [messages]);
  reactExports.useEffect(() => {
    if (isInterviewing) {
      inputRef.current?.focus();
    }
  }, [isInterviewing]);
  const handleInputChange = (e) => {
    setInput(e.target.value);
    setError(null);
    e.target.style.height = "auto";
    e.target.style.height = `${Math.min(e.target.scrollHeight, 150)}px`;
  };
  const sendMessageToBackend = reactExports.useCallback(async (message, userMessageId) => {
    if (!sessionId || !window.nexusAPI) {
      setError("Backend not available. Please run in Electron to use the interview feature.");
      return;
    }
    try {
      const assistantMessageId = nanoid();
      addMessage({
        id: assistantMessageId,
        role: "assistant",
        content: "",
        timestamp: Date.now(),
        isStreaming: true
      });
      const result = await window.nexusAPI.interview.sendMessage(sessionId, message);
      useInterviewStore.getState().updateMessage(assistantMessageId, {
        content: result.response,
        isStreaming: false
      });
      if (result.extractedRequirements && result.extractedRequirements.length > 0) {
        const now = Date.now();
        for (const req of result.extractedRequirements) {
          addRequirement({
            id: req.id,
            category: mapCategory(req.category),
            text: req.text,
            priority: mapPriority(req.priority),
            source: "interview",
            createdAt: now,
            updatedAt: now
          });
        }
      }
    } catch (err) {
      console.error("Failed to send message to backend:", err);
      setError("Failed to send message. Please try again.");
      useInterviewStore.getState().updateMessage(
        messages[messages.length - 1]?.id || "",
        { isStreaming: false }
      );
    }
  }, [sessionId, addMessage, addRequirement, messages]);
  const handleSubmit = (e) => {
    e.preventDefault();
    if (!input.trim() || isLoading) return;
    const message = input.trim();
    setInput("");
    setError(null);
    if (inputRef.current) {
      inputRef.current.style.height = "auto";
    }
    setIsLoading(true);
    const userMessageId = nanoid();
    addMessage({
      id: userMessageId,
      role: "user",
      content: message,
      timestamp: Date.now()
    });
    sendMessageToBackend(message, userMessageId).finally(() => {
      setIsLoading(false);
    });
  };
  const handleKeyDown = (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      handleSubmit(e);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: cn("flex h-full flex-col bg-bg-dark", className),
      "data-testid": "chat-panel",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 overflow-y-auto", children: messages.length === 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(WelcomeMessage, {}) : /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "p-4 space-y-4", children: [
          messages.map((message, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
            MessageBubble,
            {
              message,
              isLatest: index === messages.length - 1
            },
            message.id
          )),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { ref: messagesEndRef })
        ] }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-shrink-0 border-t border-border-default bg-bg-card p-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "flex gap-3 items-end", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 relative", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
              "textarea",
              {
                ref: inputRef,
                value: input,
                onChange: handleInputChange,
                onKeyDown: handleKeyDown,
                placeholder: "Type your message... (Shift+Enter for new line)",
                className: cn(
                  "w-full resize-none rounded-lg border bg-bg-dark px-4 py-3 text-sm",
                  "text-text-primary placeholder:text-text-tertiary",
                  "border-border-default",
                  "focus:outline-none focus:ring-2 focus:ring-accent-primary focus:border-transparent",
                  "disabled:cursor-not-allowed disabled:opacity-50",
                  "min-h-[48px] max-h-[150px]"
                ),
                rows: 1,
                disabled: !isInterviewing || isLoading,
                "data-testid": "chat-input"
              }
            ) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                type: "submit",
                disabled: !input.trim() || isLoading || !isInterviewing,
                className: cn(
                  "flex-shrink-0 h-12 w-12 rounded-lg flex items-center justify-center",
                  "bg-accent-primary text-white",
                  "hover:bg-accent-primary/90 hover:shadow-glow-primary",
                  "focus:outline-none focus:ring-2 focus:ring-accent-primary focus:ring-offset-2 focus:ring-offset-bg-dark",
                  "disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-none",
                  "transition-all duration-200"
                ),
                "data-testid": "send-button",
                children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "h-5 w-5 animate-spin" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "h-5 w-5" })
              }
            )
          ] }),
          error && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2 mt-2 text-xs text-accent-error", role: "alert", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CircleAlert, { className: "h-4 w-4 flex-shrink-0" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: error })
          ] }),
          !error && /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-text-tertiary mt-2 text-center", children: [
            "Press ",
            /* @__PURE__ */ jsxRuntimeExports.jsx("kbd", { className: "px-1.5 py-0.5 bg-bg-dark rounded border border-border-default", children: "Enter" }),
            " to send,",
            " ",
            /* @__PURE__ */ jsxRuntimeExports.jsx("kbd", { className: "px-1.5 py-0.5 bg-bg-dark rounded border border-border-default", children: "Shift+Enter" }),
            " for new line"
          ] })
        ] })
      ]
    }
  );
}
const PRIORITY_STYLES = {
  must: { bg: "bg-priority-must/20", text: "text-priority-must", label: "Must Have" },
  should: { bg: "bg-priority-should/20", text: "text-priority-should", label: "Should Have" },
  could: { bg: "bg-priority-could/20", text: "text-priority-could", label: "Could Have" },
  wont: { bg: "bg-priority-wont/20", text: "text-priority-wont", label: "Won't Have" }
};
const CATEGORY_ICONS = {
  functional: Layers,
  non_functional: Shield,
  technical: Cpu,
  constraint: Lock,
  user_story: User,
  ui: Palette,
  performance: Zap,
  security: Shield,
  integration: Plug,
  testing: TestTube
};
function RequirementCard({ requirement, isNew = false }) {
  const [isHovered, setIsHovered] = reactExports.useState(false);
  const removeRequirement = useInterviewStore((s) => s.removeRequirement);
  const updateRequirement = useInterviewStore((s) => s.updateRequirement);
  const Icon = CATEGORY_ICONS[requirement.category];
  const priorityStyle = PRIORITY_STYLES[requirement.priority];
  const handleDelete = () => {
    removeRequirement(requirement.id);
  };
  const handleEdit = () => {
    console.log("Edit requirement:", requirement.id);
  };
  const handleToggleConfirm = () => {
    updateRequirement(requirement.id, { confirmed: !requirement.confirmed });
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: cn(
        "group relative rounded-lg border bg-bg-card p-3 transition-all duration-300",
        "hover:border-accent-primary/30 hover:bg-bg-elevated",
        // New requirement animation
        isNew && "animate-in fade-in slide-in-from-right-2 duration-500",
        isNew && "ring-2 ring-accent-primary/50 shadow-glow-primary",
        // Confirmed state
        requirement.confirmed && "border-accent-success/30 bg-accent-success/5"
      ),
      onMouseEnter: () => {
        setIsHovered(true);
      },
      onMouseLeave: () => {
        setIsHovered(false);
      },
      "data-testid": "requirement-card",
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: cn(
              "flex-shrink-0 w-8 h-8 rounded-lg flex items-center justify-center",
              "bg-bg-muted"
            ),
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { className: "w-4 h-4 text-text-secondary" })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-text-primary leading-relaxed", children: requirement.text }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "mt-2 flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "span",
              {
                className: cn(
                  "inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium",
                  priorityStyle.bg,
                  priorityStyle.text
                ),
                children: priorityStyle.label
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: handleToggleConfirm,
                className: cn(
                  "flex items-center gap-1 text-xs transition-colors",
                  requirement.confirmed ? "text-accent-success" : "text-text-tertiary hover:text-text-secondary"
                ),
                title: requirement.confirmed ? "Click to unconfirm" : "Click to confirm",
                children: requirement.confirmed ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-3.5 h-3.5" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Confirmed" })
                ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
                  /* @__PURE__ */ jsxRuntimeExports.jsx(Circle, { className: "w-3.5 h-3.5" }),
                  /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Unconfirmed" })
                ] })
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: cn(
              "flex flex-col items-center gap-1 transition-opacity duration-200",
              isHovered ? "opacity-100" : "opacity-0"
            ),
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: handleEdit,
                  className: cn(
                    "rounded-lg p-1.5 transition-colors",
                    "text-text-tertiary hover:text-text-primary hover:bg-bg-hover"
                  ),
                  "aria-label": "Edit requirement",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(Pencil, { className: "h-3.5 w-3.5" })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: handleDelete,
                  className: cn(
                    "rounded-lg p-1.5 transition-colors",
                    "text-text-tertiary hover:text-accent-error hover:bg-accent-error/10"
                  ),
                  "aria-label": "Delete requirement",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "h-3.5 w-3.5" })
                }
              )
            ]
          }
        )
      ] })
    }
  );
}
const CATEGORY_CONFIG = {
  functional: {
    label: "Functional",
    icon: Layers,
    description: "Core features and capabilities"
  },
  non_functional: {
    label: "Non-Functional",
    icon: Shield,
    description: "Quality attributes and constraints"
  },
  technical: {
    label: "Technical",
    icon: Cpu,
    description: "Implementation specifications"
  },
  constraint: {
    label: "Constraints",
    icon: Lock,
    description: "Limitations and boundaries"
  },
  user_story: {
    label: "User Stories",
    icon: User,
    description: "User-centric requirements"
  },
  ui: {
    label: "UI/UX",
    icon: Palette,
    description: "Interface and experience"
  },
  performance: {
    label: "Performance",
    icon: Zap,
    description: "Speed and efficiency targets"
  },
  security: {
    label: "Security",
    icon: Shield,
    description: "Protection requirements"
  },
  integration: {
    label: "Integration",
    icon: Plug,
    description: "External system connections"
  },
  testing: {
    label: "Testing",
    icon: TestTube,
    description: "Quality assurance needs"
  }
};
function CategorySection({
  category,
  requirements,
  newRequirementIds
}) {
  const [isExpanded, setIsExpanded] = reactExports.useState(true);
  const config = CATEGORY_CONFIG[category];
  const Icon = config.icon;
  const count = requirements.length;
  if (count === 0) {
    return /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, {});
  }
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-b border-border-default/30 last:border-b-0", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "button",
      {
        onClick: () => {
          setIsExpanded(!isExpanded);
        },
        className: cn(
          "flex w-full items-center gap-3 px-4 py-3 text-left transition-colors",
          "hover:bg-bg-hover"
        ),
        "aria-expanded": isExpanded,
        "aria-controls": `category-${category}`,
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "div",
            {
              className: cn(
                "flex-shrink-0 w-5 h-5 flex items-center justify-center",
                "text-text-tertiary transition-transform duration-200",
                isExpanded && "rotate-0",
                !isExpanded && "-rotate-90"
              ),
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "w-4 h-4" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "div",
            {
              className: cn(
                "flex-shrink-0 w-7 h-7 rounded-lg flex items-center justify-center",
                "bg-bg-muted"
              ),
              children: /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { className: "w-3.5 h-3.5 text-text-secondary" })
            }
          ),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium text-text-primary", children: config.label }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-text-tertiary ml-2 hidden sm:inline", children: config.description })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "span",
            {
              className: cn(
                "flex-shrink-0 inline-flex h-5 min-w-[1.25rem] items-center justify-center rounded-full px-1.5 text-xs font-medium",
                count > 0 ? "bg-accent-primary/20 text-accent-primary" : "bg-bg-muted text-text-tertiary"
              ),
              children: count
            }
          )
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        id: `category-${category}`,
        className: cn(
          "overflow-hidden transition-all duration-300 ease-out",
          isExpanded ? "max-h-[2000px] opacity-100" : "max-h-0 opacity-0"
        ),
        children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-4 pb-3 space-y-2", children: requirements.map((requirement) => /* @__PURE__ */ jsxRuntimeExports.jsx(
          RequirementCard,
          {
            requirement,
            isNew: newRequirementIds.has(requirement.id)
          },
          requirement.id
        )) })
      }
    )
  ] });
}
const CATEGORY_ORDER = [
  "functional",
  "user_story",
  "technical",
  "non_functional",
  "constraint"
];
const STAGE_ORDER = [
  "welcome",
  "project_overview",
  "technical_requirements",
  "features",
  "constraints",
  "review",
  "complete"
];
const STAGE_LABELS = {
  welcome: "Welcome",
  project_name: "Project Name",
  project_overview: "Project Overview",
  overview: "Overview",
  functional: "Functional Requirements",
  technical: "Technical",
  technical_requirements: "Technical Requirements",
  features: "Features",
  ui: "UI/UX",
  performance: "Performance",
  security: "Security",
  integration: "Integration",
  constraints: "Constraints",
  testing: "Testing",
  summary: "Summary",
  review: "Review",
  complete: "Complete"
};
function ProgressBar({ currentStage }) {
  const currentIndex = STAGE_ORDER.indexOf(currentStage);
  const progress = currentIndex >= 0 ? (currentIndex + 1) / STAGE_ORDER.length * 100 : 0;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-2", "data-testid": "interview-progress", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between text-xs", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-text-secondary", children: STAGE_LABELS[currentStage] || "Getting Started" }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-text-tertiary", children: [
        Math.round(progress),
        "%"
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-1.5 bg-bg-dark rounded-full overflow-hidden", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: "h-full bg-accent-primary transition-all duration-500 ease-out rounded-full",
        style: { width: `${progress}%` }
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center justify-between mt-1", children: STAGE_ORDER.slice(0, -1).map((stage, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        className: cn(
          "w-2 h-2 rounded-full transition-all duration-300",
          index <= currentIndex ? "bg-accent-primary shadow-glow-primary" : "bg-border-default"
        ),
        title: STAGE_LABELS[stage]
      },
      stage
    )) })
  ] });
}
function ExportDropdown({ requirements }) {
  const [isOpen, setIsOpen] = reactExports.useState(false);
  const handleExport = (format) => {
    let content = "";
    const filename = `requirements.${format}`;
    switch (format) {
      case "json":
        content = JSON.stringify(requirements, null, 2);
        break;
      case "markdown":
        content = requirements.map(
          (r) => `## ${r.text}
- **Category:** ${r.category}
- **Priority:** ${r.priority}
`
        ).join("\n");
        break;
      case "csv":
        content = "ID,Text,Category,Priority\n" + requirements.map((r) => `"${r.id}","${r.text}","${r.category}","${r.priority}"`).join("\n");
        break;
    }
    const blob = new Blob([content], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
    setIsOpen(false);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "button",
      {
        onClick: () => {
          setIsOpen(!isOpen);
        },
        disabled: requirements.length === 0,
        className: cn(
          "flex items-center gap-1.5 px-2 py-1 rounded text-xs",
          "text-text-secondary hover:text-text-primary hover:bg-bg-hover",
          "transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        ),
        "data-testid": "export-button",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Download, { className: "w-3.5 h-3.5" }),
          "Export",
          /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: cn("w-3 h-3 transition-transform", isOpen && "rotate-180") })
        ]
      }
    ),
    isOpen && /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "fixed inset-0 z-40", onClick: () => {
        setIsOpen(false);
      } }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute right-0 top-full mt-1 z-50 w-32 py-1 bg-bg-card border border-border-default rounded-lg shadow-lg", children: ["json", "markdown", "csv"].map((format) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        "button",
        {
          onClick: () => {
            handleExport(format);
          },
          className: "w-full px-3 py-1.5 text-left text-xs text-text-secondary hover:text-text-primary hover:bg-bg-hover",
          children: format.toUpperCase()
        },
        format
      )) })
    ] })
  ] });
}
function RequirementsSidebar() {
  const requirements = useRequirements();
  const currentStage = useInterviewStage();
  const [newIds, setNewIds] = reactExports.useState(/* @__PURE__ */ new Set());
  const prevRequirements = reactExports.useRef([]);
  reactExports.useEffect(() => {
    const current = requirements;
    const prev = prevRequirements.current;
    const added = current.filter((r) => !prev.find((p) => p.id === r.id));
    if (added.length > 0) {
      setNewIds((prevIds) => /* @__PURE__ */ new Set([...prevIds, ...added.map((r) => r.id)]));
      const timeout = setTimeout(() => {
        setNewIds((prevIds) => {
          const next = new Set(prevIds);
          added.forEach((r) => next.delete(r.id));
          return next;
        });
      }, 2e3);
      prevRequirements.current = current;
      return () => {
        clearTimeout(timeout);
      };
    }
    prevRequirements.current = current;
    return void 0;
  }, [requirements]);
  const requirementsByCategory = CATEGORY_ORDER.reduce(
    (acc, category) => {
      acc[category] = requirements.filter((r) => r.category === category);
      return acc;
    },
    {}
  );
  const confirmedCount = requirements.filter((r) => r.confirmed).length;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: "flex h-full flex-col bg-bg-dark border-l border-border-default",
      "data-testid": "requirements-panel",
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "sticky top-0 z-10 border-b border-border-default bg-bg-card px-4 py-4", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between mb-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-sm font-semibold text-text-primary", children: "Requirements" }),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "span",
                {
                  className: cn(
                    "inline-flex h-5 min-w-[1.25rem] items-center justify-center rounded-full px-1.5 text-xs font-medium",
                    requirements.length > 0 ? "bg-accent-primary/20 text-accent-primary" : "bg-bg-muted text-text-tertiary"
                  ),
                  children: requirements.length
                }
              )
            ] }),
            /* @__PURE__ */ jsxRuntimeExports.jsx(ExportDropdown, { requirements })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(ProgressBar, { currentStage }),
          requirements.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-1.5 mt-3 text-xs text-text-secondary", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-3.5 h-3.5 text-accent-success" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
              confirmedCount,
              " of ",
              requirements.length,
              " confirmed"
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 overflow-y-auto", children: requirements.length > 0 ? (
          // Category sections
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "divide-y divide-border-default/30", children: CATEGORY_ORDER.map((category) => /* @__PURE__ */ jsxRuntimeExports.jsx(
            CategorySection,
            {
              category,
              requirements: requirementsByCategory[category],
              newRequirementIds: newIds
            },
            category
          )) })
        ) : (
          // Empty state
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex h-full flex-col items-center justify-center px-6 py-12 text-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "rounded-full bg-bg-card p-4 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "h-8 w-8 text-text-tertiary" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm font-medium text-text-secondary mb-1", children: "No requirements yet" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-text-tertiary max-w-[200px]", children: "Requirements will appear here as you describe your project in the chat" })
          ] })
        ) }),
        requirements.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "border-t border-border-default bg-bg-card px-4 py-3", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-xs text-text-tertiary", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-accent-primary", children: "Tip:" }),
          " Click on a requirement to edit or confirm it"
        ] }) })
      ]
    }
  );
}
const STORAGE_KEY = "nexus:interview:draft";
const DRAFT_EXPIRY_HOURS = 24;
const DEBOUNCE_DELAY_MS = 1e3;
function debounce(fn, delay) {
  let timer;
  const debounced = (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => {
      fn(...args);
    }, delay);
  };
  debounced.cancel = () => {
    clearTimeout(timer);
  };
  return debounced;
}
function useInterviewPersistence() {
  const { stage, messages, requirements, projectName, setStage, addMessage, addRequirement, setProjectName, reset } = useInterviewStore();
  const [isSaving, setIsSaving] = reactExports.useState(false);
  const [lastSaved, setLastSaved] = reactExports.useState(null);
  const hasRestoredRef = reactExports.useRef(false);
  const debouncedSaveRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    debouncedSaveRef.current = debounce(() => {
      const state = {
        stage,
        messages,
        requirements,
        projectName,
        savedAt: (/* @__PURE__ */ new Date()).toISOString()
      };
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        setLastSaved(/* @__PURE__ */ new Date());
      } catch (error) {
        console.error("Failed to save interview draft:", error);
      }
      setIsSaving(false);
    }, DEBOUNCE_DELAY_MS);
    return () => {
      debouncedSaveRef.current?.cancel();
    };
  }, []);
  reactExports.useEffect(() => {
    if (!hasRestoredRef.current) return;
    setIsSaving(true);
    debouncedSaveRef.current?.();
  }, [stage, messages, requirements, projectName]);
  const restore = reactExports.useCallback(() => {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) return null;
      const state = JSON.parse(saved);
      const savedAt = new Date(state.savedAt);
      const hoursSince = (Date.now() - savedAt.getTime()) / (1e3 * 60 * 60);
      if (hoursSince >= DRAFT_EXPIRY_HOURS) {
        localStorage.removeItem(STORAGE_KEY);
        return null;
      }
      return state;
    } catch (error) {
      console.error("Failed to restore interview draft:", error);
      return null;
    }
  }, []);
  const applyDraft = reactExports.useCallback(
    (draft) => {
      reset();
      setStage(draft.stage);
      if (draft.projectName) {
        setProjectName(draft.projectName);
      }
      draft.messages.forEach((msg) => {
        addMessage(msg);
      });
      draft.requirements.forEach((req) => {
        addRequirement(req);
      });
      hasRestoredRef.current = true;
      setLastSaved(new Date(draft.savedAt));
    },
    [reset, setStage, setProjectName, addMessage, addRequirement]
  );
  const clearDraft = reactExports.useCallback(() => {
    try {
      localStorage.removeItem(STORAGE_KEY);
      setLastSaved(null);
    } catch (error) {
      console.error("Failed to clear interview draft:", error);
    }
  }, []);
  const markAsInitialized = reactExports.useCallback(() => {
    hasRestoredRef.current = true;
  }, []);
  return {
    restore,
    applyDraft,
    clearDraft,
    markAsInitialized,
    isSaving,
    lastSaved
  };
}
function InterviewPage() {
  const navigate = useNavigate();
  const isInterviewing = useIsInterviewing();
  const requirements = useRequirements();
  const sessionId = useSessionId();
  const startInterview = useInterviewStore((s) => s.startInterview);
  const completeInterviewStore = useInterviewStore((s) => s.completeInterview);
  const reset = useInterviewStore((s) => s.reset);
  const [isCompleting, setIsCompleting] = reactExports.useState(false);
  const [isSavingDraft, setIsSavingDraft] = reactExports.useState(false);
  const { restore, applyDraft, clearDraft, markAsInitialized, isSaving, lastSaved } = useInterviewPersistence();
  const [showResumeBanner, setShowResumeBanner] = reactExports.useState(false);
  const [pendingDraft, setPendingDraft] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const draft = restore();
    if (draft && draft.messages.length > 0) {
      setPendingDraft(draft);
      setShowResumeBanner(true);
    } else {
      markAsInitialized();
      if (!isInterviewing) {
        startInterview();
      }
    }
  }, []);
  const handleResume = () => {
    if (pendingDraft) {
      applyDraft(pendingDraft);
      if (!isInterviewing) {
        startInterview();
      }
    }
    setShowResumeBanner(false);
    setPendingDraft(null);
  };
  const handleStartFresh = () => {
    clearDraft();
    markAsInitialized();
    reset();
    startInterview();
    setShowResumeBanner(false);
    setPendingDraft(null);
  };
  const handleSaveDraft = async () => {
    if (isSavingDraft) return;
    setIsSavingDraft(true);
    try {
      if (sessionId && window.nexusAPI) {
        await window.nexusAPI.interview.pause(sessionId);
        toast.success("Draft saved to server");
      } else {
        toast.info("Draft saved locally");
      }
    } catch (err) {
      console.error("Failed to save draft to backend:", err);
      toast.warning("Saved locally only - server unavailable");
    } finally {
      setIsSavingDraft(false);
    }
  };
  const handleComplete = async () => {
    if (isCompleting) return;
    setIsCompleting(true);
    try {
      if (sessionId && window.nexusAPI) {
        await window.nexusAPI.interview.end(sessionId);
      }
      completeInterviewStore();
      void navigate("/evolution", { state: { requirements } });
    } catch (err) {
      console.error("Failed to complete interview:", err);
      completeInterviewStore();
      void navigate("/evolution", { state: { requirements } });
    } finally {
      setIsCompleting(false);
    }
  };
  const formatLastSaved = () => {
    if (!lastSaved) return null;
    const now = /* @__PURE__ */ new Date();
    const diff = now.getTime() - lastSaved.getTime();
    if (diff < 6e4) {
      return "Just now";
    } else if (diff < 36e5) {
      const mins = Math.floor(diff / 6e4);
      return `${mins}m ago`;
    } else {
      return lastSaved.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
    }
  };
  const canComplete = requirements.length >= 3;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(AnimatedPage, { className: "h-full flex flex-col bg-bg-dark", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("header", { className: "flex-shrink-0 border-b border-border-default bg-bg-card px-6 py-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "button",
          {
            onClick: () => navigate(-1),
            className: "p-2 -ml-2 rounded-lg text-text-secondary hover:text-text-primary hover:bg-bg-hover transition-colors",
            "data-testid": "back-button",
            children: /* @__PURE__ */ jsxRuntimeExports.jsx(ArrowLeft, { className: "w-5 h-5" })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "w-5 h-5 text-accent-primary" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h1", { className: "text-lg font-semibold text-text-primary", children: "Genesis Interview" })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-text-secondary mt-0.5", children: "Define your project requirements through conversation" })
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-2 text-xs text-text-tertiary", children: isSaving ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "h-2 w-2 rounded-full bg-accent-warning animate-pulse" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Saving..." })
        ] }) : lastSaved ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "h-3.5 w-3.5 text-accent-success" }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
            "Saved ",
            formatLastSaved()
          ] })
        ] }) : null }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "button",
          {
            onClick: () => void handleSaveDraft(),
            disabled: isSavingDraft,
            className: cn(
              "flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium",
              "border border-border-default bg-bg-dark text-text-secondary",
              "hover:bg-bg-hover hover:text-text-primary",
              "disabled:opacity-50 disabled:cursor-not-allowed",
              "transition-colors"
            ),
            "data-testid": "save-draft-button",
            children: [
              isSavingDraft ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "w-4 h-4 animate-spin" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Save, { className: "w-4 h-4" }),
              isSavingDraft ? "Saving..." : "Save Draft"
            ]
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "button",
          {
            onClick: () => void handleComplete(),
            disabled: !canComplete || isCompleting,
            className: cn(
              "flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium",
              "bg-accent-primary text-white",
              "hover:bg-accent-primary/90 hover:shadow-glow-primary",
              "disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:shadow-none",
              "transition-all"
            ),
            "data-testid": "complete-button",
            children: isCompleting ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "h-4 w-4 rounded-full border-2 border-white border-t-transparent animate-spin" }),
              "Completing..."
            ] }) : /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(CircleCheck, { className: "w-4 h-4" }),
              "Complete"
            ] })
          }
        )
      ] })
    ] }) }),
    showResumeBanner && /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        className: "flex items-center justify-between px-6 py-3 bg-accent-primary/10 border-b border-accent-primary/20",
        "data-testid": "resume-banner",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-3", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCcw, { className: "h-5 w-5 text-accent-primary" }),
            /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium text-text-primary", children: "Resume your previous interview?" }),
              /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-text-secondary ml-2", children: [
                "(",
                pendingDraft?.messages.length || 0,
                " messages,",
                " ",
                pendingDraft?.requirements.length || 0,
                " requirements)"
              ] })
            ] })
          ] }),
          /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: handleStartFresh,
                className: cn(
                  "px-4 py-2 text-sm font-medium rounded-lg",
                  "border border-border-default text-text-secondary",
                  "hover:bg-bg-hover hover:text-text-primary",
                  "transition-colors"
                ),
                "data-testid": "start-fresh-button",
                children: "Start Fresh"
              }
            ),
            /* @__PURE__ */ jsxRuntimeExports.jsx(
              "button",
              {
                onClick: handleResume,
                className: cn(
                  "px-4 py-2 text-sm font-medium rounded-lg",
                  "bg-accent-primary text-white",
                  "hover:bg-accent-primary/90",
                  "transition-colors"
                ),
                "data-testid": "resume-button",
                children: "Resume"
              }
            )
          ] })
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx("main", { className: "flex-1 min-h-0", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      InterviewLayout,
      {
        chatPanel: /* @__PURE__ */ jsxRuntimeExports.jsx(ChatPanel, {}),
        sidebarPanel: /* @__PURE__ */ jsxRuntimeExports.jsx(RequirementsSidebar, {})
      }
    ) }),
    !showResumeBanner && /* @__PURE__ */ jsxRuntimeExports.jsxs("footer", { className: "flex-shrink-0 flex items-center justify-between px-6 py-2 border-t border-border-default bg-bg-card", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-4 text-xs text-text-tertiary", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
          requirements.length,
          " requirement",
          requirements.length !== 1 ? "s" : "",
          " captured"
        ] }),
        requirements.length < 3 && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-accent-warning", children: "Need at least 3 requirements to complete" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "button",
        {
          onClick: handleStartFresh,
          className: "flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs text-text-secondary hover:text-text-primary hover:bg-bg-hover transition-colors",
          "data-testid": "new-interview-button",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCcw, { className: "h-3.5 w-3.5" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "New Interview" })
          ]
        }
      )
    ] })
  ] });
}
export {
  InterviewPage as default
};
