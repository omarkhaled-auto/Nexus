import { c as createLucideIcon, j as jsxRuntimeExports, a as cn, r as reactExports, C as Card, b as CardContent, d as CardFooter, B as Button } from "./index--90KcRKo.js";
import { u as useMessages, a as useIsInterviewing, b as useInterviewStore, c as useRequirements, d as useInterviewStage } from "./interviewStore-67G8_etE.js";
import { L as LoaderCircle, a as Layers } from "./loader-circle-BUJwH4Gy.js";
import { A as AnimatedPage } from "./AnimatedPage-udv7kvKF.js";
import { R as RotateCcw } from "./rotate-ccw-Dx5QWuD4.js";
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$a = [["path", { d: "M20 6 9 17l-5-5", key: "1gmf2c" }]];
const Check = createLucideIcon("check", __iconNode$a);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$9 = [["path", { d: "m6 9 6 6 6-6", key: "qrunsl" }]];
const ChevronDown = createLucideIcon("chevron-down", __iconNode$9);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$8 = [["path", { d: "m9 18 6-6-6-6", key: "mthhwq" }]];
const ChevronRight = createLucideIcon("chevron-right", __iconNode$8);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$7 = [
  ["path", { d: "M12 20v2", key: "1lh1kg" }],
  ["path", { d: "M12 2v2", key: "tus03m" }],
  ["path", { d: "M17 20v2", key: "1rnc9c" }],
  ["path", { d: "M17 2v2", key: "11trls" }],
  ["path", { d: "M2 12h2", key: "1t8f8n" }],
  ["path", { d: "M2 17h2", key: "7oei6x" }],
  ["path", { d: "M2 7h2", key: "asdhe0" }],
  ["path", { d: "M20 12h2", key: "1q8mjw" }],
  ["path", { d: "M20 17h2", key: "1fpfkl" }],
  ["path", { d: "M20 7h2", key: "1o8tra" }],
  ["path", { d: "M7 20v2", key: "4gnj0m" }],
  ["path", { d: "M7 2v2", key: "1i4yhu" }],
  ["rect", { x: "4", y: "4", width: "16", height: "16", rx: "2", key: "1vbyd7" }],
  ["rect", { x: "8", y: "8", width: "8", height: "8", rx: "1", key: "z9xiuo" }]
];
const Cpu = createLucideIcon("cpu", __iconNode$7);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$6 = [
  [
    "path",
    {
      d: "M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",
      key: "1oefj6"
    }
  ],
  ["path", { d: "M14 2v5a1 1 0 0 0 1 1h5", key: "wfsgrz" }],
  ["path", { d: "M10 9H8", key: "b1mrlr" }],
  ["path", { d: "M16 13H8", key: "t4e002" }],
  ["path", { d: "M16 17H8", key: "z1uh3a" }]
];
const FileText = createLucideIcon("file-text", __iconNode$6);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$5 = [
  ["rect", { width: "18", height: "11", x: "3", y: "11", rx: "2", ry: "2", key: "1w4ew1" }],
  ["path", { d: "M7 11V7a5 5 0 0 1 10 0v4", key: "fwvmzm" }]
];
const Lock = createLucideIcon("lock", __iconNode$5);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$4 = [
  [
    "path",
    {
      d: "M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",
      key: "1a8usu"
    }
  ],
  ["path", { d: "m15 5 4 4", key: "1mk7zo" }]
];
const Pencil = createLucideIcon("pencil", __iconNode$4);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$3 = [
  [
    "path",
    {
      d: "M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",
      key: "1ffxy3"
    }
  ],
  ["path", { d: "m21.854 2.147-10.94 10.939", key: "12cjpa" }]
];
const Send = createLucideIcon("send", __iconNode$3);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$2 = [
  [
    "path",
    {
      d: "M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",
      key: "oel41y"
    }
  ]
];
const Shield = createLucideIcon("shield", __iconNode$2);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$1 = [
  ["path", { d: "M10 11v6", key: "nco0om" }],
  ["path", { d: "M14 11v6", key: "outv1u" }],
  ["path", { d: "M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6", key: "miytrc" }],
  ["path", { d: "M3 6h18", key: "d0wm0j" }],
  ["path", { d: "M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2", key: "e791ji" }]
];
const Trash2 = createLucideIcon("trash-2", __iconNode$1);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode = [
  ["path", { d: "M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2", key: "975kel" }],
  ["circle", { cx: "12", cy: "7", r: "4", key: "17ys0d" }]
];
const User = createLucideIcon("user", __iconNode);
function InterviewLayout({ children, className }) {
  return /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: cn("flex h-full w-full gap-4 p-4", className), children });
}
function ChatPanel({ className }) {
  const messages = useMessages();
  const isInterviewing = useIsInterviewing();
  const sendMessage = useInterviewStore((s) => s.sendMessage);
  const [input, setInput] = reactExports.useState("");
  const [isLoading, setIsLoading] = reactExports.useState(false);
  const messagesEndRef = reactExports.useRef(null);
  const inputRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [messages]);
  reactExports.useEffect(() => {
    if (isInterviewing) {
      inputRef.current?.focus();
    }
  }, [isInterviewing]);
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!input.trim() || isLoading) return;
    const message = input.trim();
    setInput("");
    setIsLoading(true);
    try {
      await sendMessage(message);
    } catch (error) {
      console.error("Failed to send message:", error);
    } finally {
      setIsLoading(false);
    }
  };
  const handleKeyDown = (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      void handleSubmit(e);
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(Card, { className: cn("flex h-full flex-col", className), children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardContent, { className: "flex-1 overflow-y-auto p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "space-y-4", children: [
      messages.map((message) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: cn(
            "flex",
            message.role === "user" ? "justify-end" : "justify-start"
          ),
          children: /* @__PURE__ */ jsxRuntimeExports.jsxs(
            "div",
            {
              className: cn(
                "max-w-[80%] rounded-lg px-4 py-2",
                message.role === "user" ? "bg-primary text-primary-foreground" : "bg-muted",
                message.isStreaming && "animate-pulse"
              ),
              children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "whitespace-pre-wrap text-sm", children: message.content }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "mt-1 block text-xs opacity-50", children: new Date(message.timestamp).toLocaleTimeString([], {
                  hour: "2-digit",
                  minute: "2-digit"
                }) })
              ]
            }
          )
        },
        message.id
      )),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { ref: messagesEndRef })
    ] }) }),
    /* @__PURE__ */ jsxRuntimeExports.jsx(CardFooter, { className: "border-t p-4", children: /* @__PURE__ */ jsxRuntimeExports.jsxs("form", { onSubmit: handleSubmit, className: "flex w-full gap-2", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "textarea",
        {
          ref: inputRef,
          value: input,
          onChange: (e) => setInput(e.target.value),
          onKeyDown: handleKeyDown,
          placeholder: "Type your message...",
          className: "flex-1 resize-none rounded-md border bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          rows: 1,
          disabled: !isInterviewing || isLoading
        }
      ),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        Button,
        {
          type: "submit",
          size: "icon",
          disabled: !input.trim() || isLoading || !isInterviewing,
          children: isLoading ? /* @__PURE__ */ jsxRuntimeExports.jsx(LoaderCircle, { className: "h-4 w-4 animate-spin" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "h-4 w-4" })
        }
      )
    ] }) })
  ] });
}
const PRIORITY_STYLES = {
  must: "bg-red-500/20 text-red-400",
  should: "bg-amber-500/20 text-amber-400",
  could: "bg-blue-500/20 text-blue-400",
  wont: "bg-gray-500/20 text-gray-400"
};
const PRIORITY_LABELS = {
  must: "Must",
  should: "Should",
  could: "Could",
  wont: "Won't"
};
const CATEGORY_ICONS = {
  functional: Layers,
  non_functional: Shield,
  technical: Cpu,
  constraint: Lock,
  user_story: User
};
function RequirementCard({ requirement, isNew = false }) {
  const [isHovered, setIsHovered] = reactExports.useState(false);
  const removeRequirement = useInterviewStore((s) => s.removeRequirement);
  const Icon = CATEGORY_ICONS[requirement.category];
  const handleDelete = () => {
    removeRequirement(requirement.id);
  };
  const handleEdit = () => {
    console.log("Edit requirement:", requirement.id);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: cn(
        "group relative rounded-lg border bg-card p-3 transition-all duration-300",
        "hover:border-violet-500/30 hover:bg-card/80",
        isNew && "animate-in fade-in slide-in-from-right-2 duration-500",
        isNew && "ring-2 ring-violet-500/50 shadow-[0_0_15px_rgba(139,92,246,0.3)]"
      ),
      onMouseEnter: () => {
        setIsHovered(true);
      },
      onMouseLeave: () => {
        setIsHovered(false);
      },
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { className: "mt-0.5 h-4 w-4 shrink-0 text-muted-foreground" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-foreground leading-relaxed", children: requirement.text }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-2 flex items-center gap-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            "span",
            {
              className: cn(
                "inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium",
                PRIORITY_STYLES[requirement.priority]
              ),
              children: PRIORITY_LABELS[requirement.priority]
            }
          ) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: cn(
              "flex items-center gap-1 transition-opacity duration-200",
              isHovered ? "opacity-100" : "opacity-0"
            ),
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: handleEdit,
                  className: "rounded p-1 text-muted-foreground hover:bg-muted hover:text-foreground transition-colors",
                  "aria-label": "Edit requirement",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(Pencil, { className: "h-3.5 w-3.5" })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: handleDelete,
                  className: "rounded p-1 text-muted-foreground hover:bg-destructive/20 hover:text-destructive transition-colors",
                  "aria-label": "Delete requirement",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "h-3.5 w-3.5" })
                }
              )
            ]
          }
        )
      ] })
    }
  );
}
const CATEGORY_CONFIG = {
  functional: { label: "Functional", icon: Layers },
  non_functional: { label: "Non-Functional", icon: Shield },
  technical: { label: "Technical", icon: Cpu },
  constraint: { label: "Constraints", icon: Lock },
  user_story: { label: "User Stories", icon: User }
};
function CategorySection({
  category,
  requirements,
  newRequirementIds
}) {
  const [isExpanded, setIsExpanded] = reactExports.useState(true);
  const config = CATEGORY_CONFIG[category];
  const Icon = config.icon;
  const count = requirements.length;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-b border-border/50 last:border-b-0", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "button",
      {
        onClick: () => {
          setIsExpanded(!isExpanded);
        },
        className: cn(
          "flex w-full items-center gap-2 px-4 py-3 text-left transition-colors",
          "hover:bg-muted/50"
        ),
        "aria-expanded": isExpanded,
        "aria-controls": `category-${category}`,
        children: [
          isExpanded ? /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "h-4 w-4 text-muted-foreground shrink-0" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronRight, { className: "h-4 w-4 text-muted-foreground shrink-0" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { className: "h-4 w-4 text-muted-foreground shrink-0" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium text-foreground", children: config.label }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "span",
            {
              className: cn(
                "ml-auto inline-flex h-5 min-w-[1.25rem] items-center justify-center rounded-full px-1.5 text-xs font-medium",
                count > 0 ? "bg-violet-500/20 text-violet-400" : "bg-muted text-muted-foreground"
              ),
              children: count
            }
          )
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        id: `category-${category}`,
        className: cn(
          "overflow-hidden transition-all duration-200",
          isExpanded ? "max-h-[2000px] opacity-100" : "max-h-0 opacity-0"
        ),
        children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-4 pb-3 space-y-2", children: count > 0 ? requirements.map((requirement) => /* @__PURE__ */ jsxRuntimeExports.jsx(
          RequirementCard,
          {
            requirement,
            isNew: newRequirementIds.has(requirement.id)
          },
          requirement.id
        )) : /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "py-2 text-sm text-muted-foreground/60 italic", children: "No requirements yet" }) })
      }
    )
  ] });
}
const CATEGORY_ORDER = [
  "functional",
  "user_story",
  "technical",
  "non_functional",
  "constraint"
];
const STAGE_ORDER = [
  "welcome",
  "project_overview",
  "technical_requirements",
  "features",
  "constraints",
  "review",
  "complete"
];
function RequirementsSidebar() {
  const requirements = useRequirements();
  const currentStage = useInterviewStage();
  const [newIds, setNewIds] = reactExports.useState(/* @__PURE__ */ new Set());
  const prevRequirements = reactExports.useRef([]);
  reactExports.useEffect(() => {
    const current = requirements;
    const prev = prevRequirements.current;
    const added = current.filter((r) => !prev.find((p) => p.id === r.id));
    if (added.length > 0) {
      setNewIds((prevIds) => /* @__PURE__ */ new Set([...prevIds, ...added.map((r) => r.id)]));
      const timeout = setTimeout(() => {
        setNewIds((prevIds) => {
          const next = new Set(prevIds);
          added.forEach((r) => next.delete(r.id));
          return next;
        });
      }, 2e3);
      return () => {
        clearTimeout(timeout);
      };
    }
    prevRequirements.current = current;
  }, [requirements]);
  const requirementsByCategory = CATEGORY_ORDER.reduce(
    (acc, category) => {
      acc[category] = requirements.filter((r) => r.category === category);
      return acc;
    },
    {}
  );
  const currentStageIndex = STAGE_ORDER.indexOf(currentStage);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex h-full flex-col bg-gradient-to-b from-background to-background/95", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "sticky top-0 z-10 border-b border-border bg-background/80 backdrop-blur-sm px-4 py-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-sm font-semibold text-foreground", children: "Requirements" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "span",
          {
            className: cn(
              "inline-flex h-5 min-w-[1.25rem] items-center justify-center rounded-full px-1.5 text-xs font-medium",
              requirements.length > 0 ? "bg-violet-500/20 text-violet-400" : "bg-muted text-muted-foreground"
            ),
            children: requirements.length
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-2 flex items-center gap-1.5", children: STAGE_ORDER.slice(0, -1).map((stage, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: cn(
            "h-1.5 w-1.5 rounded-full transition-colors",
            index <= currentStageIndex ? "bg-violet-500" : "bg-muted-foreground/30"
          ),
          title: stage.replace(/_/g, " ")
        },
        stage
      )) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 overflow-y-auto", children: requirements.length > 0 ? (
      // Category sections
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "divide-y divide-border/30", children: CATEGORY_ORDER.map((category) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        CategorySection,
        {
          category,
          requirements: requirementsByCategory[category],
          newRequirementIds: newIds
        },
        category
      )) })
    ) : (
      // Empty state
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex h-full flex-col items-center justify-center px-6 py-12 text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "rounded-full bg-muted/50 p-4 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "h-8 w-8 text-muted-foreground/60" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Requirements will appear here" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground/60 mt-1", children: "as you describe your project" })
      ] })
    ) })
  ] });
}
const STORAGE_KEY = "nexus:interview:draft";
const DRAFT_EXPIRY_HOURS = 24;
const DEBOUNCE_DELAY_MS = 1e3;
function debounce(fn, delay) {
  let timer;
  const debounced = (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => {
      fn(...args);
    }, delay);
  };
  debounced.cancel = () => {
    clearTimeout(timer);
  };
  return debounced;
}
function useInterviewPersistence() {
  const { stage, messages, requirements, projectName, setStage, addMessage, addRequirement, setProjectName, reset } = useInterviewStore();
  const [isSaving, setIsSaving] = reactExports.useState(false);
  const [lastSaved, setLastSaved] = reactExports.useState(null);
  const hasRestoredRef = reactExports.useRef(false);
  const debouncedSaveRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    debouncedSaveRef.current = debounce(() => {
      const state = {
        stage,
        messages,
        requirements,
        projectName,
        savedAt: (/* @__PURE__ */ new Date()).toISOString()
      };
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        setLastSaved(/* @__PURE__ */ new Date());
      } catch (error) {
        console.error("Failed to save interview draft:", error);
      }
      setIsSaving(false);
    }, DEBOUNCE_DELAY_MS);
    return () => {
      debouncedSaveRef.current?.cancel();
    };
  }, []);
  reactExports.useEffect(() => {
    if (!hasRestoredRef.current) return;
    setIsSaving(true);
    debouncedSaveRef.current?.();
  }, [stage, messages, requirements, projectName]);
  const restore = reactExports.useCallback(() => {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) return null;
      const state = JSON.parse(saved);
      const savedAt = new Date(state.savedAt);
      const hoursSince = (Date.now() - savedAt.getTime()) / (1e3 * 60 * 60);
      if (hoursSince >= DRAFT_EXPIRY_HOURS) {
        localStorage.removeItem(STORAGE_KEY);
        return null;
      }
      return state;
    } catch (error) {
      console.error("Failed to restore interview draft:", error);
      return null;
    }
  }, []);
  const applyDraft = reactExports.useCallback(
    (draft) => {
      reset();
      setStage(draft.stage);
      if (draft.projectName) {
        setProjectName(draft.projectName);
      }
      draft.messages.forEach((msg) => {
        addMessage(msg);
      });
      draft.requirements.forEach((req) => {
        addRequirement(req);
      });
      hasRestoredRef.current = true;
      setLastSaved(new Date(draft.savedAt));
    },
    [reset, setStage, setProjectName, addMessage, addRequirement]
  );
  const clearDraft = reactExports.useCallback(() => {
    try {
      localStorage.removeItem(STORAGE_KEY);
      setLastSaved(null);
    } catch (error) {
      console.error("Failed to clear interview draft:", error);
    }
  }, []);
  const markAsInitialized = reactExports.useCallback(() => {
    hasRestoredRef.current = true;
  }, []);
  return {
    restore,
    applyDraft,
    clearDraft,
    markAsInitialized,
    isSaving,
    lastSaved
  };
}
function InterviewPage() {
  const isInterviewing = useIsInterviewing();
  const startInterview = useInterviewStore((s) => s.startInterview);
  const reset = useInterviewStore((s) => s.reset);
  const { restore, applyDraft, clearDraft, markAsInitialized, isSaving, lastSaved } = useInterviewPersistence();
  const [showResumeBanner, setShowResumeBanner] = reactExports.useState(false);
  const [pendingDraft, setPendingDraft] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const draft = restore();
    if (draft && draft.messages.length > 0) {
      setPendingDraft(draft);
      setShowResumeBanner(true);
    } else {
      markAsInitialized();
      if (!isInterviewing) {
        startInterview();
      }
    }
  }, []);
  const handleResume = () => {
    if (pendingDraft) {
      applyDraft(pendingDraft);
      if (!isInterviewing) {
        startInterview();
      }
    }
    setShowResumeBanner(false);
    setPendingDraft(null);
  };
  const handleStartFresh = () => {
    clearDraft();
    markAsInitialized();
    reset();
    startInterview();
    setShowResumeBanner(false);
    setPendingDraft(null);
  };
  const handleNewInterview = () => {
    clearDraft();
    reset();
    startInterview();
  };
  const formatLastSaved = () => {
    if (!lastSaved) return null;
    const now = /* @__PURE__ */ new Date();
    const diff = now.getTime() - lastSaved.getTime();
    if (diff < 6e4) {
      return "Just now";
    } else if (diff < 36e5) {
      const mins = Math.floor(diff / 6e4);
      return `${mins}m ago`;
    } else {
      return lastSaved.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(AnimatedPage, { className: "h-full flex flex-col", children: [
    showResumeBanner && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between px-6 py-3 bg-violet-500/10 border-b border-violet-500/20", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCcw, { className: "h-4 w-4 text-violet-500" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-foreground", children: "Resume your previous interview?" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-muted-foreground", children: [
          "(",
          pendingDraft?.messages.length || 0,
          " messages,",
          " ",
          pendingDraft?.requirements.length || 0,
          " requirements)"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "button",
          {
            onClick: handleStartFresh,
            className: "px-3 py-1.5 text-xs text-muted-foreground hover:text-foreground\r\n                        border border-border rounded-md hover:bg-background/50 transition-colors",
            children: "Start Fresh"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "button",
          {
            onClick: handleResume,
            className: "px-3 py-1.5 text-xs text-white bg-violet-600 hover:bg-violet-500\r\n                        rounded-md transition-colors",
            children: "Resume"
          }
        )
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 relative", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      InterviewLayout,
      {
        chatPanel: /* @__PURE__ */ jsxRuntimeExports.jsx(ChatPanel, {}),
        sidebarPanel: /* @__PURE__ */ jsxRuntimeExports.jsx(RequirementsSidebar, {})
      }
    ) }),
    !showResumeBanner && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between px-6 py-2 border-t border-border bg-background/50 text-xs text-muted-foreground", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-1.5", children: isSaving ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "h-1.5 w-1.5 rounded-full bg-amber-500 animate-pulse" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Saving..." })
      ] }) : lastSaved ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "h-3 w-3 text-green-500" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
          "Draft saved ",
          formatLastSaved()
        ] })
      ] }) : null }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "button",
        {
          onClick: handleNewInterview,
          className: "flex items-center gap-1.5 px-2 py-1 rounded hover:bg-muted/50 transition-colors",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCcw, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "New Interview" })
          ]
        }
      )
    ] })
  ] });
}
export {
  InterviewPage as default
};
