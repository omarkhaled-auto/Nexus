import { c as createLucideIcon, j as jsxRuntimeExports, a as cn, r as reactExports, B as Button, S as Sparkles } from "./index-O-vtW4Ab.js";
import { u as useInterviewStage, a as useInterviewStore, b as useMessages, c as useRequirements, d as useIsInterviewing } from "./interviewStore-Ci_nNEYK.js";
import { L as Layers } from "./layers-6Gml_4oQ.js";
import { A as AnimatedPage } from "./AnimatedPage-Bd0ZcTM6.js";
import { R as RotateCcw } from "./rotate-ccw-DqsYyzIy.js";
import { C as Check } from "./check-DEnTLiP9.js";
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$9 = [["path", { d: "m6 9 6 6 6-6", key: "qrunsl" }]];
const ChevronDown = createLucideIcon("chevron-down", __iconNode$9);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$8 = [["path", { d: "m9 18 6-6-6-6", key: "mthhwq" }]];
const ChevronRight = createLucideIcon("chevron-right", __iconNode$8);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$7 = [
  ["path", { d: "M12 20v2", key: "1lh1kg" }],
  ["path", { d: "M12 2v2", key: "tus03m" }],
  ["path", { d: "M17 20v2", key: "1rnc9c" }],
  ["path", { d: "M17 2v2", key: "11trls" }],
  ["path", { d: "M2 12h2", key: "1t8f8n" }],
  ["path", { d: "M2 17h2", key: "7oei6x" }],
  ["path", { d: "M2 7h2", key: "asdhe0" }],
  ["path", { d: "M20 12h2", key: "1q8mjw" }],
  ["path", { d: "M20 17h2", key: "1fpfkl" }],
  ["path", { d: "M20 7h2", key: "1o8tra" }],
  ["path", { d: "M7 20v2", key: "4gnj0m" }],
  ["path", { d: "M7 2v2", key: "1i4yhu" }],
  ["rect", { x: "4", y: "4", width: "16", height: "16", rx: "2", key: "1vbyd7" }],
  ["rect", { x: "8", y: "8", width: "8", height: "8", rx: "1", key: "z9xiuo" }]
];
const Cpu = createLucideIcon("cpu", __iconNode$7);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$6 = [
  [
    "path",
    {
      d: "M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",
      key: "1oefj6"
    }
  ],
  ["path", { d: "M14 2v5a1 1 0 0 0 1 1h5", key: "wfsgrz" }],
  ["path", { d: "M10 9H8", key: "b1mrlr" }],
  ["path", { d: "M16 13H8", key: "t4e002" }],
  ["path", { d: "M16 17H8", key: "z1uh3a" }]
];
const FileText = createLucideIcon("file-text", __iconNode$6);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$5 = [
  ["rect", { width: "18", height: "11", x: "3", y: "11", rx: "2", ry: "2", key: "1w4ew1" }],
  ["path", { d: "M7 11V7a5 5 0 0 1 10 0v4", key: "fwvmzm" }]
];
const Lock = createLucideIcon("lock", __iconNode$5);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$4 = [
  [
    "path",
    {
      d: "M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",
      key: "1a8usu"
    }
  ],
  ["path", { d: "m15 5 4 4", key: "1mk7zo" }]
];
const Pencil = createLucideIcon("pencil", __iconNode$4);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$3 = [
  [
    "path",
    {
      d: "M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",
      key: "1ffxy3"
    }
  ],
  ["path", { d: "m21.854 2.147-10.94 10.939", key: "12cjpa" }]
];
const Send = createLucideIcon("send", __iconNode$3);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$2 = [
  [
    "path",
    {
      d: "M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",
      key: "oel41y"
    }
  ]
];
const Shield = createLucideIcon("shield", __iconNode$2);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode$1 = [
  ["path", { d: "M10 11v6", key: "nco0om" }],
  ["path", { d: "M14 11v6", key: "outv1u" }],
  ["path", { d: "M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6", key: "miytrc" }],
  ["path", { d: "M3 6h18", key: "d0wm0j" }],
  ["path", { d: "M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2", key: "e791ji" }]
];
const Trash2 = createLucideIcon("trash-2", __iconNode$1);
/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const __iconNode = [
  ["path", { d: "M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2", key: "975kel" }],
  ["circle", { cx: "12", cy: "7", r: "4", key: "17ys0d" }]
];
const User = createLucideIcon("user", __iconNode);
function InterviewLayout({ chatPanel, sidebarPanel }) {
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "h-screen flex flex-col md:flex-row bg-gradient-to-b from-background to-background/80", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 md:w-3/5 min-h-0 flex flex-col", children: chatPanel }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "hidden md:block border-r border-border" }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "h-1/3 md:h-auto md:w-2/5 border-t md:border-t-0 border-border min-h-0 flex flex-col", children: sidebarPanel })
  ] });
}
function ChatMessage({ message }) {
  const isUser = message.role === "user";
  const timestamp = new Date(message.timestamp).toLocaleTimeString([], {
    hour: "2-digit",
    minute: "2-digit"
  });
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(
    "div",
    {
      className: cn(
        "flex flex-col gap-1 animate-in fade-in slide-in-from-bottom-2 duration-300",
        isUser ? "items-end" : "items-start"
      ),
      children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "div",
          {
            className: cn(
              "max-w-[85%] rounded-lg px-4 py-3",
              isUser ? "bg-muted text-foreground" : "bg-transparent text-foreground"
            ),
            children: /* @__PURE__ */ jsxRuntimeExports.jsxs("p", { className: "text-sm whitespace-pre-wrap break-words leading-relaxed", children: [
              message.content,
              message.isStreaming && /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "inline-flex ml-1", children: [
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-1.5 h-1.5 rounded-full bg-violet-500 animate-pulse" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-1.5 h-1.5 rounded-full bg-violet-500 animate-pulse ml-1 animation-delay-150" }),
                /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "w-1.5 h-1.5 rounded-full bg-violet-500 animate-pulse ml-1 animation-delay-300" })
              ] })
            ] })
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-xs text-muted-foreground/60 px-1", children: timestamp })
      ]
    }
  );
}
function ChatInput({ onSend, disabled = false, placeholder = "Type your message..." }) {
  const [value, setValue] = reactExports.useState("");
  const textareaRef = reactExports.useRef(null);
  const handleSend = reactExports.useCallback(() => {
    const trimmed = value.trim();
    if (trimmed && !disabled) {
      onSend(trimmed);
      setValue("");
      if (textareaRef.current) {
        textareaRef.current.style.height = "auto";
      }
    }
  }, [value, disabled, onSend]);
  const handleKeyDown = reactExports.useCallback(
    (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleSend();
      }
    },
    [handleSend]
  );
  const handleChange = reactExports.useCallback((e) => {
    const textarea = e.target;
    setValue(textarea.value);
    textarea.style.height = "auto";
    const maxHeight = 120;
    textarea.style.height = `${Math.min(textarea.scrollHeight, maxHeight)}px`;
  }, []);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-end gap-2 p-4 border-t border-border bg-background/50 backdrop-blur-sm", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 relative", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      "textarea",
      {
        ref: textareaRef,
        value,
        onChange: handleChange,
        onKeyDown: handleKeyDown,
        placeholder,
        disabled,
        rows: 1,
        className: "w-full resize-none rounded-lg border border-input bg-background px-4 py-3 text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500/50 disabled:cursor-not-allowed disabled:opacity-50 transition-colors",
        style: { minHeight: "44px", maxHeight: "120px" }
      }
    ) }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      Button,
      {
        onClick: handleSend,
        disabled: disabled || !value.trim(),
        size: "icon",
        className: "h-11 w-11 shrink-0 bg-violet-600 hover:bg-violet-700 text-white disabled:bg-violet-600/50",
        children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx(Send, { className: "h-4 w-4" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "sr-only", children: "Send message" })
        ]
      }
    )
  ] });
}
const STAGES = [
  "welcome",
  "project_overview",
  "technical_requirements",
  "features",
  "constraints",
  "review",
  "complete"
];
const STAGE_LABELS = {
  welcome: "Start",
  project_overview: "Overview",
  technical_requirements: "Tech",
  features: "Features",
  constraints: "Limits",
  review: "Review",
  complete: "Done"
};
function StageProgress({
  currentStage: propStage,
  allowBackNavigation = true,
  onStageClick
}) {
  const storeStage = useInterviewStage();
  const setStage = useInterviewStore((s) => s.setStage);
  const currentStage = propStage ?? storeStage;
  const currentIndex = STAGES.indexOf(currentStage);
  const handleStageClick = reactExports.useCallback(
    (stage, index) => {
      if (!allowBackNavigation || index >= currentIndex) return;
      if (onStageClick) {
        onStageClick(stage);
      } else {
        setStage(stage);
      }
    },
    [allowBackNavigation, currentIndex, onStageClick, setStage]
  );
  const progressPercent = currentIndex / (STAGES.length - 1) * 100;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col gap-1.5 w-full max-w-md mx-auto", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "relative flex items-center justify-between", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "absolute left-0 right-0 h-0.5 bg-border rounded-full" }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: "absolute left-0 h-0.5 bg-violet-500 rounded-full transition-all duration-500 ease-out",
          style: { width: `${progressPercent}%` }
        }
      ),
      STAGES.map((stage, index) => {
        const isCompleted = index < currentIndex;
        const isCurrent = index === currentIndex;
        const isClickable = allowBackNavigation && isCompleted;
        return /* @__PURE__ */ jsxRuntimeExports.jsx(
          "button",
          {
            type: "button",
            onClick: () => handleStageClick(stage, index),
            disabled: !isClickable,
            className: `
                relative z-10 flex items-center justify-center
                w-3 h-3 rounded-full
                transition-all duration-300 ease-out
                ${isClickable ? "cursor-pointer hover:scale-125" : "cursor-default"}
                ${isCurrent ? "bg-violet-500 ring-4 ring-violet-500/30 shadow-lg shadow-violet-500/40" : isCompleted ? "bg-violet-500 hover:ring-2 hover:ring-violet-500/30" : "bg-muted-foreground/30"}
              `,
            title: isClickable ? `Go back to ${STAGE_LABELS[stage]}` : STAGE_LABELS[stage],
            "aria-label": `${STAGE_LABELS[stage]} stage${isCurrent ? " (current)" : isCompleted ? " (completed)" : ""}`,
            children: isCurrent && /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "absolute inset-0 rounded-full bg-violet-400 animate-pulse opacity-50" })
          },
          stage
        );
      })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex justify-between text-[10px] text-muted-foreground", children: STAGES.map((stage, index) => {
      const isCompleted = index < currentIndex;
      const isCurrent = index === currentIndex;
      return /* @__PURE__ */ jsxRuntimeExports.jsx(
        "span",
        {
          className: `
                transition-colors duration-300
                ${isCurrent ? "text-violet-500 font-medium" : isCompleted ? "text-foreground/70" : ""}
              `,
          children: STAGE_LABELS[stage]
        },
        stage
      );
    }) })
  ] });
}
function ChatPanel() {
  const messages = useMessages();
  const stage = useInterviewStage();
  const addMessage = useInterviewStore((s) => s.addMessage);
  const scrollContainerRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    if (scrollContainerRef.current) {
      scrollContainerRef.current.scrollTo({
        top: scrollContainerRef.current.scrollHeight,
        behavior: "smooth"
      });
    }
  }, [messages]);
  const handleSendMessage = reactExports.useCallback(
    (content) => {
      const newMessage = {
        id: crypto.randomUUID(),
        role: "user",
        content,
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      };
      addMessage(newMessage);
      setTimeout(() => {
        const assistantMessage = {
          id: crypto.randomUUID(),
          role: "assistant",
          content: "Thanks for sharing! I'm collecting your thoughts. (Backend integration coming soon)",
          timestamp: (/* @__PURE__ */ new Date()).toISOString()
        };
        addMessage(assistantMessage);
      }, 500);
    },
    [addMessage]
  );
  const showWelcome = stage === "welcome" && messages.length === 0;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "h-full flex flex-col", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col gap-3 px-6 py-4 border-b border-border bg-background/50 backdrop-blur-sm", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-1.5 rounded-md bg-violet-500/10", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "h-4 w-4 text-violet-500" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium text-foreground", children: "Genesis Interview" })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx(StageProgress, {})
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "div",
      {
        ref: scrollContainerRef,
        className: "flex-1 overflow-y-auto px-6 py-4 space-y-6",
        children: [
          showWelcome && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex flex-col items-center justify-center h-full text-center", children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "p-4 rounded-full bg-violet-500/10 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(Sparkles, { className: "h-8 w-8 text-violet-500" }) }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-xl font-semibold text-foreground mb-2", children: "Welcome to Genesis" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-muted-foreground max-w-md", children: "Let's build something amazing together. Tell me about the project you want to create, and I'll help you define the requirements." }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground/60 mt-4", children: "Start by describing your idea below" })
          ] }),
          messages.map((message) => /* @__PURE__ */ jsxRuntimeExports.jsx(ChatMessage, { message }, message.id))
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      ChatInput,
      {
        onSend: handleSendMessage,
        placeholder: "Describe your project idea..."
      }
    )
  ] });
}
const PRIORITY_STYLES = {
  must: "bg-red-500/20 text-red-400",
  should: "bg-amber-500/20 text-amber-400",
  could: "bg-blue-500/20 text-blue-400",
  wont: "bg-gray-500/20 text-gray-400"
};
const PRIORITY_LABELS = {
  must: "Must",
  should: "Should",
  could: "Could",
  wont: "Won't"
};
const CATEGORY_ICONS = {
  functional: Layers,
  non_functional: Shield,
  technical: Cpu,
  constraint: Lock,
  user_story: User
};
function RequirementCard({ requirement, isNew = false }) {
  const [isHovered, setIsHovered] = reactExports.useState(false);
  const removeRequirement = useInterviewStore((s) => s.removeRequirement);
  const Icon = CATEGORY_ICONS[requirement.category];
  const handleDelete = () => {
    removeRequirement(requirement.id);
  };
  const handleEdit = () => {
    console.log("Edit requirement:", requirement.id);
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsx(
    "div",
    {
      className: cn(
        "group relative rounded-lg border bg-card p-3 transition-all duration-300",
        "hover:border-violet-500/30 hover:bg-card/80",
        isNew && "animate-in fade-in slide-in-from-right-2 duration-500",
        isNew && "ring-2 ring-violet-500/50 shadow-[0_0_15px_rgba(139,92,246,0.3)]"
      ),
      onMouseEnter: () => setIsHovered(true),
      onMouseLeave: () => setIsHovered(false),
      children: /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-start gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { className: "mt-0.5 h-4 w-4 shrink-0 text-muted-foreground" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex-1 min-w-0", children: [
          /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-foreground leading-relaxed", children: requirement.text }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-2 flex items-center gap-2", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
            "span",
            {
              className: cn(
                "inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium",
                PRIORITY_STYLES[requirement.priority]
              ),
              children: PRIORITY_LABELS[requirement.priority]
            }
          ) })
        ] }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs(
          "div",
          {
            className: cn(
              "flex items-center gap-1 transition-opacity duration-200",
              isHovered ? "opacity-100" : "opacity-0"
            ),
            children: [
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: handleEdit,
                  className: "rounded p-1 text-muted-foreground hover:bg-muted hover:text-foreground transition-colors",
                  "aria-label": "Edit requirement",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(Pencil, { className: "h-3.5 w-3.5" })
                }
              ),
              /* @__PURE__ */ jsxRuntimeExports.jsx(
                "button",
                {
                  onClick: handleDelete,
                  className: "rounded p-1 text-muted-foreground hover:bg-destructive/20 hover:text-destructive transition-colors",
                  "aria-label": "Delete requirement",
                  children: /* @__PURE__ */ jsxRuntimeExports.jsx(Trash2, { className: "h-3.5 w-3.5" })
                }
              )
            ]
          }
        )
      ] })
    }
  );
}
const CATEGORY_CONFIG = {
  functional: { label: "Functional", icon: Layers },
  non_functional: { label: "Non-Functional", icon: Shield },
  technical: { label: "Technical", icon: Cpu },
  constraint: { label: "Constraints", icon: Lock },
  user_story: { label: "User Stories", icon: User }
};
function CategorySection({
  category,
  requirements,
  newRequirementIds
}) {
  const [isExpanded, setIsExpanded] = reactExports.useState(true);
  const config = CATEGORY_CONFIG[category];
  const Icon = config.icon;
  const count = requirements.length;
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "border-b border-border/50 last:border-b-0", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs(
      "button",
      {
        onClick: () => setIsExpanded(!isExpanded),
        className: cn(
          "flex w-full items-center gap-2 px-4 py-3 text-left transition-colors",
          "hover:bg-muted/50"
        ),
        "aria-expanded": isExpanded,
        "aria-controls": `category-${category}`,
        children: [
          isExpanded ? /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronDown, { className: "h-4 w-4 text-muted-foreground shrink-0" }) : /* @__PURE__ */ jsxRuntimeExports.jsx(ChevronRight, { className: "h-4 w-4 text-muted-foreground shrink-0" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(Icon, { className: "h-4 w-4 text-muted-foreground shrink-0" }),
          /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm font-medium text-foreground", children: config.label }),
          /* @__PURE__ */ jsxRuntimeExports.jsx(
            "span",
            {
              className: cn(
                "ml-auto inline-flex h-5 min-w-[1.25rem] items-center justify-center rounded-full px-1.5 text-xs font-medium",
                count > 0 ? "bg-violet-500/20 text-violet-400" : "bg-muted text-muted-foreground"
              ),
              children: count
            }
          )
        ]
      }
    ),
    /* @__PURE__ */ jsxRuntimeExports.jsx(
      "div",
      {
        id: `category-${category}`,
        className: cn(
          "overflow-hidden transition-all duration-200",
          isExpanded ? "max-h-[2000px] opacity-100" : "max-h-0 opacity-0"
        ),
        children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "px-4 pb-3 space-y-2", children: count > 0 ? requirements.map((requirement) => /* @__PURE__ */ jsxRuntimeExports.jsx(
          RequirementCard,
          {
            requirement,
            isNew: newRequirementIds.has(requirement.id)
          },
          requirement.id
        )) : /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "py-2 text-sm text-muted-foreground/60 italic", children: "No requirements yet" }) })
      }
    )
  ] });
}
const CATEGORY_ORDER = [
  "functional",
  "user_story",
  "technical",
  "non_functional",
  "constraint"
];
const STAGE_ORDER = [
  "welcome",
  "project_overview",
  "technical_requirements",
  "features",
  "constraints",
  "review",
  "complete"
];
function RequirementsSidebar() {
  const requirements = useRequirements();
  const currentStage = useInterviewStage();
  const [newIds, setNewIds] = reactExports.useState(/* @__PURE__ */ new Set());
  const prevRequirements = reactExports.useRef([]);
  reactExports.useEffect(() => {
    const current = requirements;
    const prev = prevRequirements.current;
    const added = current.filter((r) => !prev.find((p) => p.id === r.id));
    if (added.length > 0) {
      setNewIds((prevIds) => /* @__PURE__ */ new Set([...prevIds, ...added.map((r) => r.id)]));
      const timeout = setTimeout(() => {
        setNewIds((prevIds) => {
          const next = new Set(prevIds);
          added.forEach((r) => next.delete(r.id));
          return next;
        });
      }, 2e3);
      return () => clearTimeout(timeout);
    }
    prevRequirements.current = current;
  }, [requirements]);
  const requirementsByCategory = CATEGORY_ORDER.reduce(
    (acc, category) => {
      acc[category] = requirements.filter((r) => r.category === category);
      return acc;
    },
    {}
  );
  const currentStageIndex = STAGE_ORDER.indexOf(currentStage);
  return /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex h-full flex-col bg-gradient-to-b from-background to-background/95", children: [
    /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "sticky top-0 z-10 border-b border-border bg-background/80 backdrop-blur-sm px-4 py-3", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("h2", { className: "text-sm font-semibold text-foreground", children: "Requirements" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "span",
          {
            className: cn(
              "inline-flex h-5 min-w-[1.25rem] items-center justify-center rounded-full px-1.5 text-xs font-medium",
              requirements.length > 0 ? "bg-violet-500/20 text-violet-400" : "bg-muted text-muted-foreground"
            ),
            children: requirements.length
          }
        )
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "mt-2 flex items-center gap-1.5", children: STAGE_ORDER.slice(0, -1).map((stage, index) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        "div",
        {
          className: cn(
            "h-1.5 w-1.5 rounded-full transition-colors",
            index <= currentStageIndex ? "bg-violet-500" : "bg-muted-foreground/30"
          ),
          title: stage.replace(/_/g, " ")
        },
        stage
      )) })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 overflow-y-auto", children: requirements.length > 0 ? (
      // Category sections
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "divide-y divide-border/30", children: CATEGORY_ORDER.map((category) => /* @__PURE__ */ jsxRuntimeExports.jsx(
        CategorySection,
        {
          category,
          requirements: requirementsByCategory[category],
          newRequirementIds: newIds
        },
        category
      )) })
    ) : (
      // Empty state
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex h-full flex-col items-center justify-center px-6 py-12 text-center", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "rounded-full bg-muted/50 p-4 mb-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx(FileText, { className: "h-8 w-8 text-muted-foreground/60" }) }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-sm text-muted-foreground", children: "Requirements will appear here" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("p", { className: "text-xs text-muted-foreground/60 mt-1", children: "as you describe your project" })
      ] })
    ) })
  ] });
}
const STORAGE_KEY = "nexus:interview:draft";
const DRAFT_EXPIRY_HOURS = 24;
const DEBOUNCE_DELAY_MS = 1e3;
function debounce(fn, delay) {
  let timer;
  const debounced = (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => fn(...args), delay);
  };
  debounced.cancel = () => clearTimeout(timer);
  return debounced;
}
function useInterviewPersistence() {
  const { stage, messages, requirements, projectName, setStage, addMessage, addRequirement, setProjectName, reset } = useInterviewStore();
  const [isSaving, setIsSaving] = reactExports.useState(false);
  const [lastSaved, setLastSaved] = reactExports.useState(null);
  const hasRestoredRef = reactExports.useRef(false);
  const debouncedSaveRef = reactExports.useRef(null);
  reactExports.useEffect(() => {
    debouncedSaveRef.current = debounce(() => {
      const state = {
        stage,
        messages,
        requirements,
        projectName,
        savedAt: (/* @__PURE__ */ new Date()).toISOString()
      };
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        setLastSaved(/* @__PURE__ */ new Date());
      } catch (error) {
        console.error("Failed to save interview draft:", error);
      }
      setIsSaving(false);
    }, DEBOUNCE_DELAY_MS);
    return () => {
      debouncedSaveRef.current?.cancel();
    };
  }, []);
  reactExports.useEffect(() => {
    if (!hasRestoredRef.current) return;
    setIsSaving(true);
    debouncedSaveRef.current?.();
  }, [stage, messages, requirements, projectName]);
  const restore = reactExports.useCallback(() => {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) return null;
      const state = JSON.parse(saved);
      const savedAt = new Date(state.savedAt);
      const hoursSince = (Date.now() - savedAt.getTime()) / (1e3 * 60 * 60);
      if (hoursSince >= DRAFT_EXPIRY_HOURS) {
        localStorage.removeItem(STORAGE_KEY);
        return null;
      }
      return state;
    } catch (error) {
      console.error("Failed to restore interview draft:", error);
      return null;
    }
  }, []);
  const applyDraft = reactExports.useCallback(
    (draft) => {
      reset();
      setStage(draft.stage);
      if (draft.projectName) {
        setProjectName(draft.projectName);
      }
      draft.messages.forEach((msg) => {
        addMessage(msg);
      });
      draft.requirements.forEach((req) => {
        addRequirement(req);
      });
      hasRestoredRef.current = true;
      setLastSaved(new Date(draft.savedAt));
    },
    [reset, setStage, setProjectName, addMessage, addRequirement]
  );
  const clearDraft = reactExports.useCallback(() => {
    try {
      localStorage.removeItem(STORAGE_KEY);
      setLastSaved(null);
    } catch (error) {
      console.error("Failed to clear interview draft:", error);
    }
  }, []);
  const markAsInitialized = reactExports.useCallback(() => {
    hasRestoredRef.current = true;
  }, []);
  return {
    restore,
    applyDraft,
    clearDraft,
    markAsInitialized,
    isSaving,
    lastSaved
  };
}
function InterviewPage() {
  const isInterviewing = useIsInterviewing();
  const startInterview = useInterviewStore((s) => s.startInterview);
  const reset = useInterviewStore((s) => s.reset);
  const { restore, applyDraft, clearDraft, markAsInitialized, isSaving, lastSaved } = useInterviewPersistence();
  const [showResumeBanner, setShowResumeBanner] = reactExports.useState(false);
  const [pendingDraft, setPendingDraft] = reactExports.useState(null);
  reactExports.useEffect(() => {
    const draft = restore();
    if (draft && draft.messages.length > 0) {
      setPendingDraft(draft);
      setShowResumeBanner(true);
    } else {
      markAsInitialized();
      if (!isInterviewing) {
        startInterview();
      }
    }
  }, []);
  const handleResume = () => {
    if (pendingDraft) {
      applyDraft(pendingDraft);
      if (!isInterviewing) {
        startInterview();
      }
    }
    setShowResumeBanner(false);
    setPendingDraft(null);
  };
  const handleStartFresh = () => {
    clearDraft();
    markAsInitialized();
    reset();
    startInterview();
    setShowResumeBanner(false);
    setPendingDraft(null);
  };
  const handleNewInterview = () => {
    clearDraft();
    reset();
    startInterview();
  };
  const formatLastSaved = () => {
    if (!lastSaved) return null;
    const now = /* @__PURE__ */ new Date();
    const diff = now.getTime() - lastSaved.getTime();
    if (diff < 6e4) {
      return "Just now";
    } else if (diff < 36e5) {
      const mins = Math.floor(diff / 6e4);
      return `${mins}m ago`;
    } else {
      return lastSaved.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
    }
  };
  return /* @__PURE__ */ jsxRuntimeExports.jsxs(AnimatedPage, { className: "h-full flex flex-col", children: [
    showResumeBanner && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between px-6 py-3 bg-violet-500/10 border-b border-violet-500/20", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCcw, { className: "h-4 w-4 text-violet-500" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "text-sm text-foreground", children: "Resume your previous interview?" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { className: "text-xs text-muted-foreground", children: [
          "(",
          pendingDraft?.messages.length || 0,
          " messages,",
          " ",
          pendingDraft?.requirements.length || 0,
          " requirements)"
        ] })
      ] }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "button",
          {
            onClick: handleStartFresh,
            className: "px-3 py-1.5 text-xs text-muted-foreground hover:text-foreground\n                        border border-border rounded-md hover:bg-background/50 transition-colors",
            children: "Start Fresh"
          }
        ),
        /* @__PURE__ */ jsxRuntimeExports.jsx(
          "button",
          {
            onClick: handleResume,
            className: "px-3 py-1.5 text-xs text-white bg-violet-600 hover:bg-violet-500\n                        rounded-md transition-colors",
            children: "Resume"
          }
        )
      ] })
    ] }),
    /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex-1 relative", children: /* @__PURE__ */ jsxRuntimeExports.jsx(
      InterviewLayout,
      {
        chatPanel: /* @__PURE__ */ jsxRuntimeExports.jsx(ChatPanel, {}),
        sidebarPanel: /* @__PURE__ */ jsxRuntimeExports.jsx(RequirementsSidebar, {})
      }
    ) }),
    !showResumeBanner && /* @__PURE__ */ jsxRuntimeExports.jsxs("div", { className: "flex items-center justify-between px-6 py-2 border-t border-border bg-background/50 text-xs text-muted-foreground", children: [
      /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-4", children: /* @__PURE__ */ jsxRuntimeExports.jsx("div", { className: "flex items-center gap-1.5", children: isSaving ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { className: "h-1.5 w-1.5 rounded-full bg-amber-500 animate-pulse" }),
        /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "Saving..." })
      ] }) : lastSaved ? /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [
        /* @__PURE__ */ jsxRuntimeExports.jsx(Check, { className: "h-3 w-3 text-green-500" }),
        /* @__PURE__ */ jsxRuntimeExports.jsxs("span", { children: [
          "Draft saved ",
          formatLastSaved()
        ] })
      ] }) : null }) }),
      /* @__PURE__ */ jsxRuntimeExports.jsxs(
        "button",
        {
          onClick: handleNewInterview,
          className: "flex items-center gap-1.5 px-2 py-1 rounded hover:bg-muted/50 transition-colors",
          children: [
            /* @__PURE__ */ jsxRuntimeExports.jsx(RotateCcw, { className: "h-3 w-3" }),
            /* @__PURE__ */ jsxRuntimeExports.jsx("span", { children: "New Interview" })
          ]
        }
      )
    ] })
  ] });
}
export {
  InterviewPage as default
};
