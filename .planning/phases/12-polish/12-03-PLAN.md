---
phase: 12-polish
plan: 03
type: execute
depends_on: []
files_modified: [src/renderer/src/App.tsx, src/renderer/src/hooks/useKeyboardShortcuts.ts, src/renderer/src/components/KeyboardShortcutsModal.tsx]
---

<objective>
Add toast notifications with sonner and keyboard shortcuts with react-hotkeys-hook.

Purpose: Provide user feedback via toasts and power-user productivity via keyboard shortcuts.
Output: Sonner Toaster integrated, global keyboard shortcuts working, shortcuts help modal.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-polish/12-CONTEXT.md
@.planning/phases/12-polish/12-RESEARCH.md

**Relevant source files:**
@src/renderer/src/App.tsx
@src/renderer/src/stores/uiStore.ts

**From CONTEXT.md keyboard shortcuts:**
- Cmd/Ctrl + N → New project
- Cmd/Ctrl + S → Save / Create checkpoint
- Cmd/Ctrl + , → Open settings
- Cmd/Ctrl + K → Command palette
- Esc → Close modal
- ? → Show keyboard shortcuts

**From RESEARCH.md:**
- sonner: `<Toaster position="bottom-right" richColors />`
- react-hotkeys-hook: `useHotkeys('mod+s', callback, { preventDefault: true })`
- Toast usage: `toast.success()`, `toast.error()`, `toast.promise()`

**Installation required:**
```bash
pnpm add sonner react-hotkeys-hook
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install sonner and integrate Toaster</name>
  <files>package.json, src/renderer/src/App.tsx</files>
  <action>
1. Run `pnpm add sonner react-hotkeys-hook`

2. In src/renderer/src/App.tsx, add Toaster component:
```tsx
import { Toaster } from 'sonner'

function App() {
  // ... existing code

  return (
    <>
      <RouterProvider router={router} />
      <Toaster
        position="bottom-right"
        richColors
        closeButton
        toastOptions={{
          duration: 4000,
        }}
      />
    </>
  )
}
```

3. Remove or deprecate the existing custom toast system in uiStore (keep for backward compatibility but mark as deprecated, prefer sonner)

4. Create utility export for easy toast access:
```typescript
// src/renderer/src/lib/toast.ts
export { toast } from 'sonner'
```

5. Update one existing usage to use sonner (e.g., in a component that shows notifications) to verify it works
  </action>
  <verify>Toast appears when toast.success('Test') called, positioned bottom-right</verify>
  <done>Sonner Toaster integrated, toast() function available throughout app</done>
</task>

<task type="auto">
  <name>Task 2: Create keyboard shortcuts hook</name>
  <files>src/renderer/src/hooks/useKeyboardShortcuts.ts</files>
  <action>
Create src/renderer/src/hooks/useKeyboardShortcuts.ts:

```typescript
import { useHotkeys } from 'react-hotkeys-hook'
import { useNavigate } from 'react-router'
import { toast } from 'sonner'
import { useUIStore } from '../stores/uiStore'

export function useGlobalShortcuts(): void {
  const navigate = useNavigate()

  // Cmd/Ctrl + N → New project
  useHotkeys('mod+n', (e) => {
    e.preventDefault()
    navigate('/genesis')
    toast.info('Starting new project...')
  })

  // Cmd/Ctrl + S → Create checkpoint
  useHotkeys('mod+s', (e) => {
    e.preventDefault()
    // TODO: Connect to checkpoint creation when available
    toast.success('Checkpoint created')
  })

  // Cmd/Ctrl + , → Open settings
  useHotkeys('mod+,', (e) => {
    e.preventDefault()
    navigate('/settings')
  })

  // Cmd/Ctrl + K → Command palette (future feature)
  useHotkeys('mod+k', (e) => {
    e.preventDefault()
    toast.info('Command palette coming soon')
    // TODO: Implement command palette in future
  })

  // ? → Show keyboard shortcuts (when not in input)
  useHotkeys('?', () => {
    useUIStore.getState().setShowShortcuts(true)
  }, {
    enableOnFormTags: false
  })

  // Esc → Close modals
  useHotkeys('escape', () => {
    useUIStore.getState().setShowShortcuts(false)
  })
}

// Shortcuts data for display in modal
export const KEYBOARD_SHORTCUTS = [
  { keys: ['Cmd/Ctrl', 'N'], description: 'New project' },
  { keys: ['Cmd/Ctrl', 'S'], description: 'Create checkpoint' },
  { keys: ['Cmd/Ctrl', ','], description: 'Open settings' },
  { keys: ['Cmd/Ctrl', 'K'], description: 'Command palette' },
  { keys: ['?'], description: 'Show keyboard shortcuts' },
  { keys: ['Esc'], description: 'Close modal' },
]
```

Note: Add `showShortcuts` and `setShowShortcuts` to uiStore if not present.
  </action>
  <verify>Cmd+, opens settings, Cmd+N navigates to genesis</verify>
  <done>Keyboard shortcuts hook created with all specified shortcuts</done>
</task>

<task type="auto">
  <name>Task 3: Create keyboard shortcuts modal and integrate</name>
  <files>src/renderer/src/components/KeyboardShortcutsModal.tsx, src/renderer/src/stores/uiStore.ts, src/renderer/src/App.tsx</files>
  <action>
1. Add to uiStore.ts:
```typescript
showShortcuts: boolean
setShowShortcuts: (show: boolean) => void
```

2. Create src/renderer/src/components/KeyboardShortcutsModal.tsx:
```tsx
import { Dialog, DialogContent, DialogHeader, DialogTitle } from './ui/dialog'
import { useUIStore } from '../stores/uiStore'
import { KEYBOARD_SHORTCUTS } from '../hooks/useKeyboardShortcuts'

export function KeyboardShortcutsModal() {
  const showShortcuts = useUIStore((s) => s.showShortcuts)
  const setShowShortcuts = useUIStore((s) => s.setShowShortcuts)

  return (
    <Dialog open={showShortcuts} onOpenChange={setShowShortcuts}>
      <DialogContent className="max-w-md">
        <DialogHeader>
          <DialogTitle>Keyboard Shortcuts</DialogTitle>
        </DialogHeader>
        <div className="space-y-2">
          {KEYBOARD_SHORTCUTS.map((shortcut, i) => (
            <div key={i} className="flex justify-between items-center py-2 border-b border-border last:border-0">
              <span className="text-muted-foreground">{shortcut.description}</span>
              <div className="flex gap-1">
                {shortcut.keys.map((key, j) => (
                  <kbd
                    key={j}
                    className="px-2 py-1 text-xs font-mono bg-muted rounded border border-border"
                  >
                    {key}
                  </kbd>
                ))}
              </div>
            </div>
          ))}
        </div>
      </DialogContent>
    </Dialog>
  )
}
```

3. In App.tsx:
   - Import and call useGlobalShortcuts() at root level
   - Add <KeyboardShortcutsModal /> component
```tsx
import { useGlobalShortcuts } from './hooks/useKeyboardShortcuts'
import { KeyboardShortcutsModal } from './components/KeyboardShortcutsModal'

function App() {
  useGlobalShortcuts()

  return (
    <>
      <RouterProvider router={router} />
      <Toaster ... />
      <KeyboardShortcutsModal />
    </>
  )
}
```
  </action>
  <verify>Press ? to show shortcuts modal, Esc to close</verify>
  <done>Keyboard shortcuts modal shows all shortcuts, accessible via ? key</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm run build:electron` succeeds
- [ ] `pnpm run typecheck` passes
- [ ] sonner and react-hotkeys-hook installed
- [ ] Toast notifications appear bottom-right
- [ ] Cmd+, opens settings
- [ ] Cmd+N navigates to genesis
- [ ] ? opens shortcuts modal
- [ ] Esc closes modal
- [ ] Shortcuts don't fire when typing in input fields
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Toast notifications work with success/error/warning/info
- All keyboard shortcuts functional
- Shortcuts modal displays all available shortcuts
</success_criteria>

<output>
After completion, create `.planning/phases/12-polish/12-03-SUMMARY.md`
</output>
