---
phase: 06-interview-ui
plan: 04
type: execute
depends_on: ["06-03"]
files_modified:
  - src/renderer/src/pages/InterviewPage.tsx
  - src/renderer/src/components/interview/StageProgress.tsx
  - src/renderer/src/hooks/useInterviewPersistence.ts
  - src/renderer/src/hooks/index.ts
---

<objective>
Complete interview UI with stage progression, persistence, and polish.

Purpose: Add interview state persistence, stage progression UI, and final polish for a production-quality interview experience.
Output: Fully functional interview UI ready for backend integration in Phase 9.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-interview-ui/06-CONTEXT.md
@.planning/phases/06-interview-ui/06-03-SUMMARY.md
@src/renderer/src/stores/interviewStore.ts
@src/renderer/src/pages/InterviewPage.tsx
@src/renderer/src/bridges/UIBackendBridge.ts

**Tech stack available:** React 19, Zustand, Tailwind v4, lucide-react
**Established patterns:** Cursor-style aesthetic, hooks for cross-cutting concerns
**Design context:** Auto-save, resume from checkpoint, 7-stage progression
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StageProgress component and stage UI</name>
  <files>src/renderer/src/components/interview/StageProgress.tsx, src/renderer/src/components/interview/index.ts</files>
  <action>
**StageProgress.tsx:**
- Visual representation of 7 interview stages as a horizontal progress bar
- Props: `currentStage: InterviewStage`
- Each stage as a dot or step indicator:
  - Completed stages: filled violet dot
  - Current stage: filled violet dot with ring/glow
  - Future stages: empty/muted dot
- Stage labels below dots (can be abbreviated on mobile)
- Smooth transition animation between stages
- Clickable stages to jump back (for review), but not forward

Stage labels (short form):
- welcome → "Start"
- project_overview → "Overview"
- technical_requirements → "Tech"
- features → "Features"
- constraints → "Limits"
- review → "Review"
- complete → "Done"

Progress calculation: `(stageIndex / 6) * 100%` for progress bar fill

Design:
- Horizontal bar with evenly spaced dots
- Current position highlighted
- Subtle connecting line between dots
- Compact enough to fit in ChatPanel header area

Add to barrel export.
  </action>
  <verify>StageProgress renders correctly with different stage values</verify>
  <done>Stage dots display, current stage highlighted, transitions smooth</done>
</task>

<task type="auto">
  <name>Task 2: Add interview persistence and session recovery</name>
  <files>src/renderer/src/hooks/useInterviewPersistence.ts, src/renderer/src/hooks/index.ts, src/renderer/src/pages/InterviewPage.tsx</files>
  <action>
**useInterviewPersistence.ts:**
Custom hook for interview state persistence:

```typescript
export function useInterviewPersistence() {
  const store = useInterviewStore()

  // Save to localStorage on state changes (debounced)
  useEffect(() => {
    const saveState = debounce(() => {
      const state = {
        stage: store.stage,
        messages: store.messages,
        requirements: store.requirements,
        projectName: store.projectName,
        savedAt: new Date().toISOString()
      }
      localStorage.setItem('nexus:interview:draft', JSON.stringify(state))
    }, 1000)

    saveState()
    return () => saveState.cancel?.()
  }, [store.stage, store.messages, store.requirements, store.projectName])

  // Restore from localStorage on mount
  const restore = useCallback(() => {
    const saved = localStorage.getItem('nexus:interview:draft')
    if (saved) {
      const state = JSON.parse(saved)
      // Only restore if saved within last 24 hours
      const savedAt = new Date(state.savedAt)
      const hoursSince = (Date.now() - savedAt.getTime()) / (1000 * 60 * 60)
      if (hoursSince < 24) {
        return state
      }
    }
    return null
  }, [])

  const clearDraft = useCallback(() => {
    localStorage.removeItem('nexus:interview:draft')
  }, [])

  return { restore, clearDraft }
}
```

Simple debounce helper (or use lodash-es if available):
```typescript
function debounce<T extends (...args: unknown[]) => void>(fn: T, delay: number) {
  let timer: ReturnType<typeof setTimeout>
  const debounced = (...args: Parameters<T>) => {
    clearTimeout(timer)
    timer = setTimeout(() => fn(...args), delay)
  }
  debounced.cancel = () => clearTimeout(timer)
  return debounced
}
```

Create hooks barrel export `src/renderer/src/hooks/index.ts`.

**Update InterviewPage.tsx:**
- Use `useInterviewPersistence()` hook
- On mount: Check for saved draft
  - If found: Show "Resume interview?" prompt or auto-restore
  - If not found: Start fresh
- Integrate StageProgress into ChatPanel header
- Add "New Interview" button to reset and clear draft
- Show "Draft saved" indicator when auto-saving (subtle toast or text)

Resume flow:
```typescript
useEffect(() => {
  const { restore } = useInterviewPersistence()
  const draft = restore()
  if (draft && !isInterviewing) {
    // Could show modal: "Resume previous interview?"
    // For now, auto-restore
    setStage(draft.stage)
    // ... restore other state
  }
}, [])
```
  </action>
  <verify>Close and reopen app, verify interview state persists</verify>
  <done>Interview state saves to localStorage, restores on reload</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete interview UI with stage progression and persistence</what-built>
  <how-to-verify>
    1. Run: pnpm run dev:electron
    2. Navigate to /genesis
    3. Verify: Stage progress shows at top of chat panel
    4. Verify: "Start" stage is highlighted
    5. Type a message and send
    6. Add a test requirement via console
    7. Close the app completely (Cmd+Q / Alt+F4)
    8. Reopen: pnpm run dev:electron
    9. Navigate to /genesis
    10. Verify: Previous message is restored
    11. Verify: Requirement is restored
    12. Click on a completed stage dot
    13. Verify: Stage jumps back (if implemented)
    14. Verify: Overall polish and visual consistency
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] StageProgress shows 7 stages correctly
- [ ] Current stage highlighted with visual indicator
- [ ] Interview state persists to localStorage
- [ ] State restores on app reload
- [ ] Draft auto-saves with debounce
- [ ] Full interview UI feels polished and cohesive
- [ ] `npx tsc --noEmit` - no TypeScript errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Human verification approved
- Interview UI ready for Phase 9 backend integration
- Phase 6 complete
</success_criteria>

<output>
After completion, create `.planning/phases/06-interview-ui/06-04-SUMMARY.md`

Phase 6 complete. UI ready for backend interview engine (Phase 9).
</output>
