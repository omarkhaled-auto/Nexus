---
phase: 01-foundation
plan: 02
type: execute
depends_on: ["01-01"]
files_modified: [src/types/core.ts, src/types/task.ts, src/types/agent.ts, src/types/index.ts]
---

<objective>
Create core TypeScript type definitions for projects, features, tasks, and agents.

Purpose: Establish the type foundation that all services depend on - these interfaces define the shape of data throughout the system.
Output: Complete type definitions in src/types/ with full TypeScript strict mode compliance.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-CONTEXT.md

**Reference specifications:**
- Master Book Section 4.2 BUILD-002: Type Definitions (6 hours)
- Master Book Section 3.4: Core TypeScript Interfaces

**Key types from Master Book:**
- Project, Feature, SubFeature, Requirement (core.ts ~150-200 LOC)
- Task, TaskStatus, TaskResult (task.ts ~100-150 LOC)
- Agent, AgentType, AgentStatus, AgentMetrics (agent.ts ~150-200 LOC)

**Prior plan reference:**
@.planning/phases/01-foundation/01-01-SUMMARY.md (when available)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create core project types</name>
  <files>src/types/core.ts</files>
  <action>
Create src/types/core.ts with the following types:

```typescript
// Project lifecycle
export type ProjectStatus = 'initializing' | 'interviewing' | 'planning' | 'executing' | 'paused' | 'completed' | 'failed';
export type ProjectMode = 'genesis' | 'evolution';

// MoSCoW prioritization
export type Priority = 'must' | 'should' | 'could' | 'wont';

// Requirement categories
export type RequirementCategory =
  | 'functional'
  | 'non-functional'
  | 'ui-ux'
  | 'technical'
  | 'business-logic'
  | 'integration';

export interface Project {
  id: string;
  name: string;
  description: string;
  mode: ProjectMode;
  status: ProjectStatus;
  rootPath: string;
  repositoryUrl?: string;
  features: Feature[];
  requirements: Requirement[];
  createdAt: Date;
  updatedAt: Date;
  completedAt?: Date;
  metrics: ProjectMetrics;
}

export interface Feature {
  id: string;
  projectId: string;
  name: string;
  description: string;
  priority: Priority;
  status: FeatureStatus;
  subFeatures: SubFeature[];
  estimatedTasks: number;
  completedTasks: number;
  createdAt: Date;
  updatedAt: Date;
}

export type FeatureStatus = 'backlog' | 'in-progress' | 'ai-review' | 'human-review' | 'done';

export interface SubFeature {
  id: string;
  featureId: string;
  name: string;
  description: string;
  status: FeatureStatus;
  taskIds: string[];
}

export interface Requirement {
  id: string;
  projectId: string;
  category: RequirementCategory;
  description: string;
  priority: Priority;
  source?: string; // Interview question or context
  linkedFeatures: string[];
  validated: boolean;
  createdAt: Date;
}

export interface ProjectMetrics {
  totalFeatures: number;
  completedFeatures: number;
  totalTasks: number;
  completedTasks: number;
  totalTokensUsed: number;
  totalCost: number;
  averageQAIterations: number;
  startedAt?: Date;
  estimatedCompletion?: Date;
}
```

Use strict types - no `any`. All optional fields must be explicitly marked.
  </action>
  <verify>pnpm typecheck passes</verify>
  <done>core.ts contains Project, Feature, SubFeature, Requirement, and related types with full strict mode compliance</done>
</task>

<task type="auto">
  <name>Task 2: Create task types</name>
  <files>src/types/task.ts</files>
  <action>
Create src/types/task.ts with the following types:

```typescript
import type { AgentType } from './agent';

// Task lifecycle
export type TaskStatus =
  | 'pending'      // Not yet started
  | 'queued'       // Ready for agent assignment
  | 'assigned'     // Agent assigned, not started
  | 'executing'    // Agent working on task
  | 'qa-loop'      // In QA loop (build/lint/test/review)
  | 'review'       // Awaiting human review
  | 'completed'    // Successfully completed
  | 'failed'       // Failed after max retries
  | 'blocked';     // Blocked by dependency or issue

// Task sizing per Master Book
export type TaskSize = 'atomic' | 'small';
// atomic: 5-15 minutes, single file
// small: 15-30 minutes, 1-2 files
// NO task can exceed 30 minutes (HARD LIMIT)

export interface Task {
  id: string;
  projectId: string;
  featureId?: string;
  subFeatureId?: string;
  name: string;
  description: string;
  status: TaskStatus;
  size: TaskSize;

  // Execution context
  assignedAgent?: string;
  worktreePath?: string;
  branchName?: string;

  // Dependencies
  dependsOn: string[]; // Task IDs
  blockedBy?: string;  // Blocking task/issue ID

  // QA tracking
  qaIterations: number;
  maxIterations: number; // Default 50
  lastQAResult?: QAResult;

  // Timing
  estimatedMinutes: number;
  actualMinutes?: number;
  startedAt?: Date;
  completedAt?: Date;

  // Output
  filesCreated: string[];
  filesModified: string[];
  testsWritten: string[];

  createdAt: Date;
  updatedAt: Date;
}

export interface TaskResult {
  taskId: string;
  status: 'success' | 'failure' | 'escalated';
  qaIterations: number;
  duration: number; // milliseconds
  filesChanged: FileChange[];
  testResults?: TestResult;
  reviewResult?: ReviewResult;
  error?: TaskError;
}

export interface FileChange {
  path: string;
  operation: 'create' | 'modify' | 'delete';
  additions: number;
  deletions: number;
}

export interface QAResult {
  iteration: number;
  timestamp: Date;
  buildResult: StageResult;
  lintResult: StageResult;
  testResult: StageResult;
  reviewResult?: ReviewResult;
  passed: boolean;
  nextAction: 'continue' | 'fix' | 'escalate';
}

export interface StageResult {
  stage: 'build' | 'lint' | 'test' | 'review';
  passed: boolean;
  errors: string[];
  warnings: string[];
  duration: number; // milliseconds
}

export interface TestResult {
  passed: number;
  failed: number;
  skipped: number;
  coverage?: number; // percentage
  duration: number;
  failures: TestFailure[];
}

export interface TestFailure {
  testName: string;
  file: string;
  error: string;
  stack?: string;
}

export interface ReviewResult {
  approved: boolean;
  reviewer: 'ai' | 'human';
  issues: ReviewIssue[];
  suggestions: string[];
  timestamp: Date;
}

export interface ReviewIssue {
  severity: 'critical' | 'major' | 'minor' | 'suggestion';
  category: 'security' | 'performance' | 'style' | 'logic' | 'test-coverage';
  file: string;
  line?: number;
  message: string;
  suggestedFix?: string;
}

export interface TaskError {
  code: string;
  message: string;
  stack?: string;
  recoverable: boolean;
}
```

Use strict types throughout. Import AgentType from agent.ts.
  </action>
  <verify>pnpm typecheck passes</verify>
  <done>task.ts contains Task, TaskStatus, TaskResult, QAResult and all related types</done>
</task>

<task type="auto">
  <name>Task 3: Create agent types and index</name>
  <files>src/types/agent.ts, src/types/index.ts</files>
  <action>
Create src/types/agent.ts:

```typescript
// Agent types per Master Book specification
export type AgentType = 'planner' | 'coder' | 'tester' | 'reviewer' | 'merger';

export type AgentStatus =
  | 'idle'       // Ready for work
  | 'assigned'   // Has task, not started
  | 'executing'  // Running task
  | 'waiting'    // Waiting for external resource (API, review)
  | 'error'      // Encountered error
  | 'terminated'; // Shut down

// Model configuration per agent type
export interface ModelConfig {
  model: string;
  maxTokens: number;
  temperature: number;
  provider: 'anthropic' | 'google' | 'openai';
}

// Agent configurations from Master Book
export const AGENT_CONFIGS: Record<AgentType, ModelConfig> = {
  planner: { model: 'claude-opus-4', maxTokens: 8000, temperature: 0.7, provider: 'anthropic' },
  coder: { model: 'claude-sonnet-4', maxTokens: 16000, temperature: 0.3, provider: 'anthropic' },
  tester: { model: 'claude-sonnet-4', maxTokens: 8000, temperature: 0.3, provider: 'anthropic' },
  reviewer: { model: 'gemini-2.5-pro', maxTokens: 8000, temperature: 0.2, provider: 'google' },
  merger: { model: 'claude-sonnet-4', maxTokens: 4000, temperature: 0.1, provider: 'anthropic' }
} as const;

export interface Agent {
  id: string;
  type: AgentType;
  status: AgentStatus;

  // Current work
  currentTaskId?: string;
  worktreePath?: string;
  branchName?: string;

  // Metrics
  metrics: AgentMetrics;

  // Lifecycle
  spawnedAt: Date;
  lastActivityAt: Date;
  terminatedAt?: Date;
  terminationReason?: string;
}

export interface AgentMetrics {
  tasksCompleted: number;
  tasksFailed: number;
  totalTokensUsed: number;
  totalCost: number;
  averageTaskDuration: number; // milliseconds
  qaIterationsTotal: number;
  successRate: number; // percentage
}

// Tool definitions available to agents
export type AgentTool =
  | 'file_read'
  | 'file_write'
  | 'file_edit'
  | 'terminal'
  | 'search_code'
  | 'git_status'
  | 'git_diff'
  | 'git_commit'
  | 'run_tests'
  | 'run_lint';

// Tool access per agent type
export const AGENT_TOOLS: Record<AgentType, AgentTool[]> = {
  planner: ['file_read', 'search_code'],
  coder: ['file_read', 'file_write', 'file_edit', 'terminal', 'search_code', 'git_status', 'git_diff'],
  tester: ['file_read', 'file_write', 'terminal', 'run_tests', 'search_code'],
  reviewer: ['file_read', 'search_code', 'git_diff'],
  merger: ['file_read', 'git_status', 'git_diff', 'git_commit', 'terminal']
} as const;

// Agent pool configuration
export interface AgentPoolConfig {
  maxConcurrentAgents: number; // Default 4
  idleTimeout: number; // milliseconds before terminating idle agent
  spawnDelay: number; // milliseconds between spawns
}

export const DEFAULT_POOL_CONFIG: AgentPoolConfig = {
  maxConcurrentAgents: 4,
  idleTimeout: 300000, // 5 minutes
  spawnDelay: 1000 // 1 second
} as const;
```

Create src/types/index.ts that re-exports all types:

```typescript
// Core types
export * from './core';

// Task types
export * from './task';

// Agent types
export * from './agent';
```
  </action>
  <verify>pnpm typecheck passes with all types compiling correctly</verify>
  <done>agent.ts contains Agent, AgentType, AgentStatus, AGENT_CONFIGS, AGENT_TOOLS. index.ts re-exports all types.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm typecheck` passes with zero errors
- [ ] All types use strict typing (no `any`)
- [ ] Types match Master Book Section 3.4 specifications
- [ ] index.ts correctly re-exports all types
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Types ready for events/API definitions (Plan 01-03)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
