---
phase: 05-ui-foundation
plan: 01
type: execute
depends_on: []
files_modified: [electron.vite.config.ts, src/main/main.ts, src/preload/index.ts, src/renderer/index.html, src/renderer/src/main.tsx]
---

<objective>
Set up Electron + Vite scaffold with electron-vite build tooling for separate main/preload/renderer processes.

Purpose: Establish the Electron desktop application foundation that all UI phases will build on.
Output: Working Electron window with React renderer, proper security configuration (contextIsolation, no nodeIntegration).
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ui-foundation/05-RESEARCH.md
@.planning/phases/05-ui-foundation/05-CONTEXT.md
@.planning/phases/04-orchestration/04-03-SUMMARY.md

**Tech stack available:** Vitest, TypeScript 5.3+, existing src/ structure
**Established patterns:** Singleton pattern (EventBus), TypeScript strict mode
**Key constraint:** electron-vite is the build tool, not Electron Forge

**Nexus-specific:**
- Current structure has `src/main.ts` as CLI entry point - keep it, Electron is separate
- Create new `src/main/` for Electron main process
- Create new `src/preload/` for preload scripts
- Create new `src/renderer/` for React app
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Electron dependencies and configure electron-vite</name>
  <files>package.json, electron.vite.config.ts, electron-builder.yml</files>
  <action>
Install required packages:
```bash
pnpm add -D electron electron-vite @electron-toolkit/preload @electron-toolkit/utils
pnpm add -D @vitejs/plugin-react
```

Create `electron.vite.config.ts` at project root:
- Main build config pointing to `src/main/main.ts`
- Preload build config pointing to `src/preload/index.ts`
- Renderer config with React plugin, root at `src/renderer`, base `./` for production
- Alias `@` to `src/renderer/src`

Create `electron-builder.yml` with basic config for Windows/Mac/Linux builds.

Update `package.json`:
- Add `"main": "out/main/main.js"` (electron-vite output)
- Add scripts: `"dev:electron": "electron-vite dev"`, `"build:electron": "electron-vite build"`, `"preview:electron": "electron-vite preview"`

**Avoid:** Don't use Electron Forge - electron-vite is simpler and has better Vite integration.
  </action>
  <verify>
- `pnpm run dev:electron` starts without errors (may show empty window)
- `npx tsc --noEmit` passes on config files
  </verify>
  <done>electron-vite configured, scripts added, dependencies installed</done>
</task>

<task type="auto">
  <name>Task 2: Create Electron main process with security configuration</name>
  <files>src/main/main.ts, src/main/index.ts</files>
  <action>
Create `src/main/main.ts` - the Electron main process entry:
- Import `app, BrowserWindow` from electron
- Create `mainWindow: BrowserWindow | null = null`
- `createWindow()` function with BrowserWindow config:
  - width: 1200, height: 800
  - webPreferences: contextIsolation: true, nodeIntegration: false, sandbox: true, preload path
- Load from `ELECTRON_RENDERER_URL` in dev or `../renderer/index.html` in prod
- Handle `app.whenReady()`, `activate`, `window-all-closed` events
- Export for testing

Create `src/main/index.ts` as re-export barrel file.

**Security requirements (non-negotiable):**
- `contextIsolation: true` - separates preload from renderer
- `nodeIntegration: false` - no Node.js in renderer
- `sandbox: true` - additional isolation

**Avoid:** Don't expose any Node.js APIs directly. All communication via IPC.
  </action>
  <verify>
- `pnpm run dev:electron` opens an Electron window (blank/error is OK at this stage)
- Main process code compiles without TypeScript errors
  </verify>
  <done>Main process runs, window opens with correct security settings</done>
</task>

<task type="auto">
  <name>Task 3: Create preload script with nexusAPI stub and renderer entry</name>
  <files>src/preload/index.ts, src/renderer/index.html, src/renderer/src/main.tsx, src/renderer/src/App.tsx</files>
  <action>
Create `src/preload/index.ts`:
- Import `contextBridge` from electron
- Create stub `nexusAPI` object with placeholder methods that return promises
- Use `contextBridge.exposeInMainWorld('nexusAPI', nexusAPI)`
- Add TypeScript declaration for `window.nexusAPI`

Stub methods (to be implemented in 05-04):
```typescript
const nexusAPI = {
  // Mode operations
  startGenesis: async () => { console.log('stub: startGenesis'); return { success: true }; },
  startEvolution: async (projectId: string) => { console.log('stub: startEvolution', projectId); return { success: true }; },
  // Will add more in 05-04
}
```

Create `src/renderer/index.html`:
- Basic HTML5 structure
- `<div id="root"></div>` for React mount
- Script tag with `type="module" src="./src/main.tsx"`

Create `src/renderer/src/main.tsx`:
- Import React and ReactDOM
- Import `App` component
- `ReactDOM.createRoot(document.getElementById('root')!).render(<App />)`

Create `src/renderer/src/App.tsx`:
- Simple placeholder: `<div>Nexus</div>`
- Will be expanded in 05-02 through 05-05

**Avoid:** Never expose raw `ipcRenderer` - only specific wrapped methods. Never pass `event` object to callbacks.
  </action>
  <verify>
- `pnpm run dev:electron` shows "Nexus" text in window
- DevTools console shows no security warnings
- `window.nexusAPI` is available in DevTools console
  </verify>
  <done>Preload exposes nexusAPI, renderer shows React content, security intact</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm run dev:electron` opens Electron window with React content
- [ ] DevTools console: `window.nexusAPI` exists with stub methods
- [ ] No TypeScript errors: `npx tsc --noEmit`
- [ ] Security: contextIsolation enabled, nodeIntegration disabled
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Electron window opens with React rendered inside
- nexusAPI exposed via contextBridge (stubs only)
- No security warnings in DevTools
  </success_criteria>

<output>
After completion, create `.planning/phases/05-ui-foundation/05-01-SUMMARY.md`:

# Phase 05-01: Electron + Vite Scaffold Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 05-02-PLAN.md (shadcn/ui + Tailwind setup)
</output>
