---
phase: 11-integration-testing
plan: 04
type: execute
depends_on: ["11-01"]
files_modified: [playwright.config.ts, e2e/fixtures/electron.ts, e2e/fixtures/seed.ts, e2e/page-objects/InterviewPage.ts, e2e/page-objects/KanbanPage.ts, e2e/page-objects/DashboardPage.ts]
---

<objective>
Set up Playwright E2E testing infrastructure for Electron app.

Purpose: Configure Playwright with Electron support, create reusable fixtures and page objects for E2E tests.
Output: Working Playwright setup that can launch the Electron app and interact with all major pages.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/11-integration-testing/11-CONTEXT.md
@.planning/phases/11-integration-testing/11-RESEARCH.md
@.planning/phases/11-integration-testing/11-01-SUMMARY.md

**From RESEARCH.md - Playwright Electron pattern:**
```typescript
const electronApp = await electron.launch({ args: ['dist/main.js'] })
const window = await electronApp.firstWindow()
```

**UI Pages (from Phases 5-8):**
- InterviewPage: Chat interface, requirements sidebar
- KanbanPage: Feature cards, drag-drop columns
- DashboardPage: Progress metrics, agent activity, event log
- CheckpointPage: Checkpoint list, review modal

**Key source files:**
@src/renderer/src/pages/InterviewPage.tsx
@src/renderer/src/pages/KanbanPage.tsx
@src/renderer/src/pages/DashboardPage.tsx
@src/renderer/src/components/checkpoint/CheckpointList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Playwright for Electron</name>
  <files>playwright.config.ts</files>
  <action>
Create Playwright configuration optimized for Electron testing:

```typescript
import { defineConfig } from '@playwright/test'

export default defineConfig({
  testDir: './e2e',
  timeout: 60000,  // Longer timeout for Electron startup
  retries: process.env.CI ? 2 : 0,
  workers: 1,  // Serial execution for Electron (avoid conflicts)
  reporter: [['html', { open: 'never' }], ['list']],
  use: {
    trace: 'on-first-retry',
    video: 'on-first-retry',
  },
})
```

Key decisions:
- `workers: 1` for serial execution (multiple Electron instances can conflict)
- 60s timeout to allow for app startup + rendering
- Trace and video on retry for debugging CI failures
- No browser projects (Electron-only)
  </action>
  <verify>`npx playwright test --list` shows config is valid</verify>
  <done>playwright.config.ts exists with Electron-appropriate settings</done>
</task>

<task type="auto">
  <name>Task 2: Create Electron test fixtures</name>
  <files>e2e/fixtures/electron.ts, e2e/fixtures/seed.ts</files>
  <action>
**electron.ts** - Reusable Electron app fixture:
```typescript
import { test as base, _electron as electron, ElectronApplication, Page } from '@playwright/test'

interface ElectronFixtures {
  electronApp: ElectronApplication
  window: Page
}

export const test = base.extend<ElectronFixtures>({
  electronApp: async ({}, use) => {
    const app = await electron.launch({
      args: ['dist/main.js'],
      env: { ...process.env, NODE_ENV: 'test' }
    })
    // Capture console for debugging
    app.on('console', msg => console.log(`[Electron] ${msg.text()}`))
    await use(app)
    await app.close()
  },
  window: async ({ electronApp }, use) => {
    const window = await electronApp.firstWindow()
    await window.waitForLoadState('domcontentloaded')
    await use(window)
  },
})

export { expect } from '@playwright/test'
```

**seed.ts** - Test data seeding:
```typescript
export async function seedTestProject(window: Page) {
  // Create test project via IPC or direct navigation
  await window.evaluate(() => {
    // Seed project store with test data
    window.testBridge?.seedProject({ name: 'Test Project', mode: 'genesis' })
  })
}

export async function seedFeatures(window: Page, features: Feature[]) {
  // Seed feature store for Evolution mode tests
}
```
  </action>
  <verify>Create minimal e2e/smoke.spec.ts that uses fixtures, runs `npx playwright test e2e/smoke.spec.ts`</verify>
  <done>Electron fixtures launch app, provide window, clean up properly</done>
</task>

<task type="auto">
  <name>Task 3: Create page objects for major pages</name>
  <files>e2e/page-objects/InterviewPage.ts, e2e/page-objects/KanbanPage.ts, e2e/page-objects/DashboardPage.ts</files>
  <action>
Create page object classes that encapsulate page interactions:

**InterviewPage.ts:**
```typescript
export class InterviewPage {
  constructor(private page: Page) {}

  async navigate() { await this.page.goto('/interview') }
  async sendMessage(text: string) {
    await this.page.fill('[data-testid="chat-input"]', text)
    await this.page.click('[data-testid="send-button"]')
  }
  async waitForResponse() {
    await this.page.waitForSelector('[data-testid="assistant-message"]')
  }
  getRequirements() {
    return this.page.locator('[data-testid="requirement-item"]')
  }
  async completeInterview() {
    await this.page.click('[data-testid="complete-interview"]')
  }
}
```

**KanbanPage.ts:**
- navigate(), getColumns(), getFeatureCards()
- dragFeature(featureId, targetColumn)
- openFeatureModal(featureId)
- triggerPlanning(featureId)

**DashboardPage.ts:**
- navigate(), getProgressBar()
- getAgentCards(), getEventLog()
- waitForAgentStatus(agentId, status)

Use data-testid selectors consistently. Add them to source components if missing.
  </action>
  <verify>`npx tsc --noEmit e2e/**/*.ts` passes</verify>
  <done>Page objects exist for Interview, Kanban, Dashboard with typed methods</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx playwright test --list` shows valid config
- [ ] Smoke test launches Electron and closes cleanly
- [ ] Page objects compile without TypeScript errors
- [ ] Electron app starts in test mode
</verification>

<success_criteria>

- Playwright configured for Electron testing
- Electron fixtures handle app lifecycle
- Page objects encapsulate UI interactions
- Smoke test verifies setup works
</success_criteria>

<output>
After completion, create `.planning/phases/11-integration-testing/11-04-SUMMARY.md`
</output>
