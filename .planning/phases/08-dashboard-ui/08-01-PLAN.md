---
phase: 08-dashboard-ui
plan: 01
type: tdd
depends_on: []
files_modified:
  - package.json
  - src/renderer/src/types/metrics.ts
  - src/renderer/src/types/index.ts
  - src/renderer/src/stores/metricsStore.ts
  - src/renderer/src/stores/metricsStore.test.ts
  - src/renderer/src/stores/index.ts
---

<objective>
Create metricsStore foundation with TDD for real-time dashboard state management.

Purpose: Establish the data layer for dashboard metrics, timeline events, agent status, and cost tracking using the same Zustand patterns as existing stores.
Output: Type-safe metricsStore with 8+ selector hooks, verified by comprehensive tests.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-dashboard-ui/08-CONTEXT.md
@.planning/phases/08-dashboard-ui/08-RESEARCH.md

**Existing patterns to follow:**
@src/renderer/src/stores/featureStore.ts
@src/renderer/src/stores/featureStore.test.ts
@src/renderer/src/types/feature.ts

**Tech stack available:** Zustand 5.x, Vitest, React 19
**Established patterns:** Zustand stores with selector hooks, TDD with RED-GREEN-REFACTOR
</context>

<feature>
  <name>metricsStore - Dashboard State Management</name>
  <files>src/renderer/src/stores/metricsStore.ts, src/renderer/src/stores/metricsStore.test.ts, src/renderer/src/types/metrics.ts</files>
  <behavior>
    Store manages dashboard state with these behaviors:

    **State:**
    - overview: OverviewMetrics | null (total features, completed tasks, active agents, est. completion)
    - timeline: TimelineEvent[] (max 100 items, newest first)
    - agents: AgentMetrics[] (4 agents with status, current task, progress)
    - costs: CostMetrics | null (total cost, token breakdown)
    - isLoading: boolean
    - lastUpdated: Date | null

    **Actions:**
    - setOverview(overview) → updates overview, sets lastUpdated
    - addTimelineEvent(event) → prepends to timeline, caps at 100, sets lastUpdated
    - updateAgentMetrics(agentId, update) → updates specific agent, sets lastUpdated
    - setAgents(agents) → replaces all agents (initial load)
    - setCosts(costs) → updates costs, sets lastUpdated
    - setLoading(isLoading) → updates loading state
    - reset() → resets to initial state

    **Selector hooks:**
    - useOverview() → overview state
    - useTimeline() → timeline events
    - useAgentMetrics() → agents array
    - useCosts() → costs state
    - useIsMetricsLoading() → loading state
    - useActiveAgentCount() → count of agents with status 'working'
    - useTaskProgress() → { completed, total, percent }
    - useLastUpdated() → last update timestamp

    **Test cases:**
    - setOverview updates state and lastUpdated
    - addTimelineEvent prepends event to timeline
    - addTimelineEvent caps timeline at 100 items
    - updateAgentMetrics updates correct agent by ID
    - updateAgentMetrics ignores unknown agent IDs
    - setAgents replaces entire agents array
    - setCosts updates costs and lastUpdated
    - reset returns to initial state
    - useActiveAgentCount returns correct count
    - useTaskProgress calculates percentage correctly
    - useTaskProgress handles zero total gracefully
  </behavior>
  <implementation>
    1. Install dependencies: recharts, react-virtuoso (prep for later plans)
    2. Create types in src/renderer/src/types/metrics.ts
    3. Write failing tests following featureStore.test.ts pattern
    4. Implement store following featureStore.ts pattern
    5. Export from stores/index.ts and types/index.ts
  </implementation>
</feature>

<verification>
- [ ] `pnpm test src/renderer/src/stores/metricsStore.test.ts` - all tests pass
- [ ] `pnpm typecheck` - no TypeScript errors
- [ ] Package.json includes recharts and react-virtuoso
</verification>

<success_criteria>
- Recharts and React Virtuoso installed
- Types defined: OverviewMetrics, TimelineEvent, AgentMetrics, CostMetrics
- metricsStore created with 7 actions
- 8 selector hooks exported
- 11+ tests passing (RED → GREEN → REFACTOR complete)
- All exports added to barrel files
</success_criteria>

<output>
After completion, create `.planning/phases/08-dashboard-ui/08-01-SUMMARY.md`:

# Phase 08-01: metricsStore Foundation Summary

**[Substantive one-liner]**

## TDD Metrics

| Metric | Value |
|--------|-------|
| Tests Written | [N] |
| Status | ALL PASS |

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- [Files with descriptions]

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 08-02-PLAN.md (Core Components)
</output>
