---
phase: 08-dashboard-ui
plan: 04
type: execute
depends_on: ["08-02", "08-03"]
files_modified:
  - src/renderer/src/components/dashboard/CostTracker.tsx
  - src/renderer/src/components/dashboard/index.ts
  - src/renderer/src/bridges/UIBackendBridge.ts
  - src/renderer/src/pages/DashboardPage.tsx
  - src/preload/index.ts
  - src/main/ipc/handlers.ts
---

<objective>
Integrate all dashboard components and wire real-time event subscriptions.

Purpose: Complete the Dashboard UI by assembling all components into DashboardPage, adding cost tracking, and connecting to EventBus for real-time updates.
Output: Fully functional DashboardPage with live metrics, agent grid, event timeline, and cost display.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-dashboard-ui/08-CONTEXT.md
@.planning/phases/08-dashboard-ui/08-RESEARCH.md

**Prior plan context:**
@.planning/phases/08-dashboard-ui/08-01-SUMMARY.md
@.planning/phases/08-dashboard-ui/08-02-SUMMARY.md
@.planning/phases/08-dashboard-ui/08-03-SUMMARY.md

**Existing IPC patterns:**
@src/renderer/src/bridges/UIBackendBridge.ts
@src/preload/index.ts
@src/main/ipc/handlers.ts

**Dashboard components available:**
- MetricCard, OverviewCards, ProgressChart (from 08-02)
- AgentCard, AgentActivity, EventRow, TaskTimeline (from 08-03)
- metricsStore with selectors (from 08-01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CostTracker component</name>
  <files>src/renderer/src/components/dashboard/CostTracker.tsx, src/renderer/src/components/dashboard/index.ts</files>
  <action>
    Create CostTracker component that displays token usage and costs.

    **Uses useCosts() selector from metricsStore**

    CostMetrics type (from 08-01):
    - totalCost: number (USD)
    - inputTokens: number
    - outputTokens: number
    - byAgent?: Record<string, { cost: number, tokens: number }>

    **Visual design:**
    Compact card showing:
    - Total cost: "$X.XX" prominently
    - Token breakdown: "Input: X | Output: Y" in muted text
    - Optional: per-agent breakdown if byAgent provided

    Styling:
    - Small card, can be placed in header or sidebar
    - DollarSign icon from Lucide
    - Green text for cost if under budget (assume $50 budget for now)
    - Yellow if approaching, red if over

    **Handle null costs:**
    - Show "$0.00" with "No usage yet" subtitle

    Update barrel export to include CostTracker.
  </action>
  <verify>CostTracker renders cost display, handles null state</verify>
  <done>CostTracker displays total cost, token breakdown, handles empty state gracefully</done>
</task>

<task type="auto">
  <name>Task 2: Add dashboard event subscriptions to UIBackendBridge</name>
  <files>src/renderer/src/bridges/UIBackendBridge.ts, src/preload/index.ts, src/main/ipc/handlers.ts</files>
  <action>
    Extend UIBackendBridge to subscribe to dashboard-relevant events.

    **Add to preload/index.ts nexusAPI:**
    - onMetricsUpdate: (callback: (metrics: OverviewMetrics) => void) => () => void
    - onAgentStatusUpdate: (callback: (status: AgentMetrics) => void) => () => void
    - onTimelineEvent: (callback: (event: TimelineEvent) => void) => () => void
    - onCostUpdate: (callback: (costs: CostMetrics) => void) => () => void

    Follow existing pattern from onTaskUpdate, onAgentStatus.

    **Add IPC handlers in main/ipc/handlers.ts:**
    - Listen for EventBus events and forward to renderer:
      - task:started, task:completed, task:failed → timeline events
      - agent:status_changed → agent metrics update
      - qa:iteration, qa:passed, qa:failed → timeline events
      - metrics:updated → overview metrics
      - costs:updated → cost metrics

    Note: These handlers will receive events from EventBus (already implemented in Phase 4).
    For now, create stub handlers that can receive events - actual EventBus integration happens when orchestration runs.

    **Add subscriptions in UIBackendBridge.initialize():**
    ```typescript
    // Dashboard subscriptions
    if (window.nexusAPI?.onMetricsUpdate) {
      const unsub = window.nexusAPI.onMetricsUpdate((metrics) => {
        useMetricsStore.getState().setOverview(metrics)
      })
      this.unsubscribers.push(unsub)
    }

    if (window.nexusAPI?.onAgentStatusUpdate) {
      const unsub = window.nexusAPI.onAgentStatusUpdate((status) => {
        useMetricsStore.getState().updateAgentMetrics(status.id, status)
      })
      this.unsubscribers.push(unsub)
    }

    if (window.nexusAPI?.onTimelineEvent) {
      const unsub = window.nexusAPI.onTimelineEvent((event) => {
        useMetricsStore.getState().addTimelineEvent(event)
      })
      this.unsubscribers.push(unsub)
    }

    if (window.nexusAPI?.onCostUpdate) {
      const unsub = window.nexusAPI.onCostUpdate((costs) => {
        useMetricsStore.getState().setCosts(costs)
      })
      this.unsubscribers.push(unsub)
    }
    ```

    **Guard all calls with null checks** (learned from Phase 7 hotfixes).
  </action>
  <verify>
    - `pnpm typecheck` passes
    - UIBackendBridge.initialize() includes new subscriptions
    - No runtime errors in non-Electron context (tests)
  </verify>
  <done>UIBackendBridge subscribes to 4 new event types, updates metricsStore on events. All guarded for non-Electron contexts.</done>
</task>

<task type="auto">
  <name>Task 3: Wire DashboardPage with all components</name>
  <files>src/renderer/src/pages/DashboardPage.tsx</files>
  <action>
    Replace placeholder DashboardPage with full implementation.

    **Layout (responsive grid):**
    ```
    ┌─────────────────────────────────────────────────────────────┐
    │  Dashboard                                    [CostTracker] │
    ├─────────────────────────────────────────────────────────────┤
    │  [OverviewCards - 4 metric cards in row]                    │
    ├─────────────────────────────────────────────────────────────┤
    │  [ProgressChart]              │  [AgentActivity]            │
    │  (60% width)                  │  (40% width)                │
    ├─────────────────────────────────────────────────────────────┤
    │  [TaskTimeline - full width, flexible height]               │
    └─────────────────────────────────────────────────────────────┘
    ```

    **Implementation:**
    ```tsx
    export default function DashboardPage(): ReactElement {
      const isLoading = useIsMetricsLoading()

      return (
        <div className="flex flex-col h-full p-6 gap-6">
          {/* Header */}
          <div className="flex items-center justify-between">
            <h1 className="text-2xl font-bold">Dashboard</h1>
            <CostTracker />
          </div>

          {/* Overview Cards */}
          <OverviewCards />

          {/* Middle row: Chart + Agents */}
          <div className="grid grid-cols-1 lg:grid-cols-5 gap-6">
            <div className="lg:col-span-3">
              <ProgressChart />
            </div>
            <div className="lg:col-span-2">
              <AgentActivity />
            </div>
          </div>

          {/* Timeline */}
          <div className="flex-1 min-h-0">
            <TaskTimeline />
          </div>
        </div>
      )
    }
    ```

    **Loading state:**
    - Show skeleton loaders or loading indicators if isLoading is true
    - Can use simple opacity-50 + animate-pulse for initial implementation

    **Demo data for testing:**
    - Add useEffect to populate metricsStore with demo data on mount
    - This allows visual testing before real EventBus events flow
    - Demo data: 4 agents, ~10 timeline events, sample overview metrics

    Import all components from '../components/dashboard'
    Import selectors from '../stores'
  </action>
  <verify>
    - `pnpm typecheck` passes
    - DashboardPage renders all sections
    - Responsive layout works (mobile stacks, desktop grid)
  </verify>
  <done>DashboardPage displays header with cost, 4 overview cards, chart + agents grid, timeline. Responsive layout works.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Dashboard UI with metrics, agent grid, progress chart, and event timeline</what-built>
  <how-to-verify>
    1. Run: `pnpm dev:electron`
    2. Navigate to Dashboard page (via mode selector or direct)
    3. Verify layout:
       - Header shows "Dashboard" title and cost tracker
       - 4 metric cards in responsive row
       - Progress chart on left, agent grid on right (desktop)
       - Event timeline at bottom with filter chips
    4. Verify dark theme:
       - Chart colors visible (purple gradient)
       - Status dots have correct colors
       - Text is readable on dark background
    5. Verify interactivity:
       - Filter chips toggle timeline events
       - Hover on timeline pauses auto-scroll
       - Chart tooltip appears on hover
    6. Verify responsiveness:
       - Resize window: components stack on narrow viewport
       - No horizontal overflow
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 8, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `pnpm typecheck` - no TypeScript errors
- [ ] `pnpm test` - all tests pass (including metricsStore tests from 08-01)
- [ ] Dashboard renders all sections correctly
- [ ] Dark theme colors work throughout
- [ ] Responsive layout verified
- [ ] Human verification approved
</verification>

<success_criteria>
- CostTracker displays cost and token breakdown
- UIBackendBridge subscribes to 4 dashboard event types
- DashboardPage integrates all components
- Responsive layout works on mobile and desktop
- Dark theme applied consistently
- Human verification passed
- Phase 8 complete
</success_criteria>

<output>
After completion, create `.planning/phases/08-dashboard-ui/08-04-SUMMARY.md`:

# Phase 08-04: Dashboard Integration Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- [Files with descriptions]

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 8 complete. Ready for Phase 9 (Interview Engine).

## Phase 8 Totals

| Metric | Value |
|--------|-------|
| Plans | 4 |
| Components Created | ~10 |
| Tests Added | ~XX |
| LOC | ~XXX |
</output>
